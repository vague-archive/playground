var On=Object.defineProperty,Tn=(t,e,s)=>e in t?On(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,p=(t,e,s)=>(Tn(t,typeof e!="symbol"?e+"":e,s),s),li=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},O=(t,e,s)=>(li(t,e,"read from private field"),s?s.call(t):e.get(t)),G=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},K=(t,e,s,i)=>(li(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),oe=(t,e,s)=>(li(t,e,"access private method"),s);function hr(t,e){let s=new Error(e);throw s.name=t,s}var tr=new Map;function ci(t,e){tr.has(t)||(tr.set(t,!0),console.warn(e??t))}var sr=new Map;function Cn(t,e){sr.has(t)||(sr.set(t,!0),console.log(e??t))}function Zt(t,e){if(!t)throw new Error(`\u{1F92F} ${e??"Assertion failed"}`)}function Mn(t){throw new Error(`This value is never supposed to exist ${t}`)}function L(t,e){if(t==null)throw new Error(e??"Expected value to not be null or undefined")}var Pn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",En=(t,e,s)=>{let i=(2<<Math.log(t.length-1)/Math.LN2)-1,r=-~(1.6*i*e/t.length);return(n=e)=>{let a="";for(;;){let o=s(r),c=r;for(;c--;)if(a+=t[o[c]&i]||"",a.length===n)return a}}},ui=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,s)=>(s&=63,s<36?e+=s.toString(36):s<62?e+=(s-26).toString(36).toUpperCase():s>62?e+="-":e+="_",e),"");function An(t,e,s){let i={x:e.x-t.x,y:e.y-t.y},r=di(i);return r<=s||(i.x*=s/r,i.y*=s/r),i}function di(t){return Math.sqrt(t.x**2+t.y**2)}var pr=class te{constructor(e,s){p(this,"x"),p(this,"y"),this.x=e,this.y=s}static distance(e,s){return di({x:s.x-e.x,y:s.y-e.y})}toString(){return`vec(${this.x}, ${this.y})`}toJSON(){return{x:this.x,y:this.y,__serializedName:te.serializedName}}static fromJSON({x:e,y:s}){return new te(e,s)}get xy(){return[this.x,this.y]}get magnitude(){return Math.sqrt(this.x**2+this.y**2)}get length(){return this.magnitude}get angle(){return Math.atan2(this.y,this.x)}add(...e){let[s,i]=h(e[0],e[1]).xy;return new te(this.x+s,this.y+i)}mutAdd(...e){let[s,i]=h(e[0],e[1]).xy;return this.x+=s,this.y+=i,this}mul(...e){let[s,i]=h(e[0],e[1]).xy;return new te(this.x*s,this.y*i)}mutMul(...e){let[s,i]=h(e[0],e[1]).xy;return new te(this.x*s,this.y*i)}div(...e){let[s,i]=h(e[0],e[1]).xy;return new te(this.x/s,this.y/i)}mutDiv(...e){let[s,i]=h(e[0],e[1]).xy;return new te(this.x/s,this.y/i)}scale(...e){let[s,i]=h(e[0],e[1]).xy;return new te(this.x*s,this.y*i)}mutScale(...e){let[s,i]=h(e[0],e[1]).xy;return this.x*=s,this.y*=i,this}subtract(...e){let[s,i]=h(e[0],e[1]).xy;return new te(this.x-s,this.y-i)}mutSubtract(...e){let[s,i]=h(e[0],e[1]).xy;return this.x-=s,this.y-=i,this}dot(...e){let[s,i]=h(e[0],e[1]).xy;return this.x*s+this.y*i}cross(...e){let[s,i]=h(e[0],e[1]).xy;return this.x*i-this.y*s}lerp(...e){if(e.length===3){let[s,i]=h(e[0],e[1]).xy,r=e[2];return new te(this.x+r*(s-this.x),this.y+r*(i-this.y))}else{let[s,i]=h(e[0]).xy,r=e[1];return new te(this.x+r*(s-this.x),this.y+r*(i-this.y))}}mutLerp(...e){if(e.length===3){let[s,i]=h(e[0],e[1]).xy,r=e[2];return this.mutAdd(r*(s-this.x),r*(i-this.y))}else{let[s,i]=h(e[0]).xy,r=e[1];return this.mutAdd(r*(s-this.x),r*(i-this.y))}}clamp(e){let s=this.magnitude;return s<=e?this:this.scale(e/s)}rotate(e){let s=Math.cos(e),i=Math.sin(e),r=this.x,n=this.y;return this.x=r*s-n*i,this.y=r*i+n*s,Math.abs(this.x)<1e-8&&(this.x=0),Math.abs(this.y)<1e-8&&(this.y=0),this}normalize(){return this.clamp(1)}mutClamp(e){let s=this.magnitude;return s<=e?this:this.mutScale(e/s)}transform(e){let s=this.x*e[0]+this.y*e[4]+e[8],i=this.x*e[1]+this.y*e[5]+e[9];return new te(s,i)}};p(pr,"serializedName","Vector.v1");var mt=pr;function h(...t){let[e,s]=t;if(In(e))return new mt(e.x,e.y);if(Array.isArray(e)){if(e.length!==2)throw new Error(`invalid arguments for Vector: ${t.join(", ")}`);return new mt(e[0],e[1])}if(e!==void 0&&s!==void 0)return new mt(e,s);if(e!==void 0)return new mt(e,e);throw new Error(`invalid arguments for Vector: ${t.join(", ")}`)}function In(t){return t!=null&&typeof t=="object"&&"x"in t&&"y"in t&&typeof t.x=="number"&&typeof t.y=="number"}var Nn="|\xC9q\xC5",Rn="M",Pt=null,Yt=null,Kt=null,Bs={},Ws={};function Ln(){return Pt||(Pt=document.createElement("canvas"),Pt.width=10,Pt.height=10),Pt}function zn(){return Yt||(Yt=document.createElement("canvas"),Kt=Yt.getContext("2d")),L(Kt,"Failed to get canvas context"),Kt.clearRect(0,0,1920,1080),{canvas:Yt,context:Kt}}function hi(t,e){var s;return`${Ss(e)} ${(s=e.color)==null?void 0:s.join(",")} ${e.align} | ${t}`}function ks(t,e){let s={color:[1,1,1,1],fontFamily:"Helvetica",fontSize:24,x:0,y:0,z:0,rotation:0,scale:h(1),skew:h(0),...e},i=Ss(s),r=hi(t,s);if(Ws[r])return Ws[r];let n=Ln().getContext("2d");L(n,"Failed to get canvas context"),n.font=i,n.textBaseline="top";let a;if(Bs[i])a=Bs[i];else{let u=n.measureText(Nn+Rn);Bs[i]=a=u.actualBoundingBoxDescent+u.actualBoundingBoxAscent}let o=t.split(/(?:\r\n|\r|\n)/),c=[],l=0;for(let u of o){let m=n.measureText(u).width;c.push(m),m>l&&(l=m)}let d=o.length*a;return Ws[r]={width:l,height:d,lineWidths:c}}function fr(t,e){let{width:s,height:i}=ks(t,e);hi(t,e);let{canvas:r,context:n}=zn(),a=window.devicePixelRatio;r.width=s*a,r.height=i*a,r.style.width=`${s}px`,r.style.height=`${i}px`,r.style.imageRendering="pixelated",n.scale(a,a);let o=`rgba(${e.color.map((d,u)=>u==3?d:Math.floor(d*255)).join(",")})`;n.font=Ss(e),n.textAlign=e.align??"start",n.textBaseline="top",n.fillStyle=o;let c=t.split(/(?:\r\n|\r|\n)/),l=0;for(let d of c){let u=0;e.align==="right"?u=s:e.align==="center"&&(u=s/2),n.fillText(d,u,l),l+=i/c.length}return{canvas:r,width:s,height:i}}function Ss(t){let e=`${t?.fontSize??24}px`,s=t?.fontStyle??"normal",i=t?.fontWeight??"normal",r=t?.fontFamily??"Helvetica";return`${s} normal ${i} ${e} "${r}"`}function B(t,e,s){return Math.min(Math.max(t,e),s)}function z(t,e,s){return(1-s)*t+s*e}function mr(t,e,s){return{x:z(t.x,e.x,s),y:z(t.y,e.y,s)}}function Un(t,e,s){return z(e,s,(Math.sin(t)+1)/2)}function gr(t){return t*(Math.PI/180)}function Zn(t){return t*(180/Math.PI)}function St(t,e=60){return Math.round(t*(e==="unbounded"?60:e))}function Ne(t,e=60){return e===0?0:t/(e==="unbounded"?60:e)}var D={RED:$(1,0,0,1),LIME:$(0,1,0,1),BLUE:$(0,0,1,1),YELLOW:$(1,1,0,1),MAGENTA:$(1,0,1,1),CYAN:$(0,1,1,1),BLACK:$(0,0,0,1),WHITE:$(1,1,1,1),GRAY:$(.4,.4,.4,1),GREEN:$(0,.5,0,1),ORANGE:$(1,.5,0,1)};function Fn(t,e){return[t[0],t[1],t[2],e]}function $(...t){if(t.length===3||t.length===4)return[t[0],t[1],t[2],t[3]??1];if(t.length===1){let e=t[0];if(Array.isArray(e))return[e[0],e[1],e[2],e[3]??1];if(typeof e=="object")return[e.r,e.g,e.b,e.a??1]}return D.BLACK}function jn(...t){let e=0,s=0,i=0,r=1;if(pi(t))e=t[0],s=t[1],i=t[2],r=t[3]??1;else if(t.length===1){let l=t[0];Array.isArray(l)?(e=l[0],s=l[1],i=l[2],r=l[3]??1):l.r!=null&&l.g!=null&&l.b!=null&&(e=l.r,s=l.g,i=l.b,r=l.a??1)}let n=B(e,0,255),a=B(s,0,255),o=B(i,0,255),c=B(r,0,1);return $(n/255,a/255,o/255,c)}function $n(...t){let e=0,s=0,i=0,r=1;if(pi(t))e=t[0],s=t[1],i=t[2],r=t[3]??1;else if(t.length===1){let S=t[0];Array.isArray(S)?(e=S[0],s=S[1],i=S[2],r=S[3]??1):S.h!=null&&S.s!=null&&S.v!=null&&(e=S.h,s=S.s,i=S.v,r=S.a??1)}let n=B(e,0,360)/360,a=B(s,0,1),o=B(i,0,1),c=B(r,0,1),l=Math.floor(n*6),d=n*6-l,u=o*(1-a),m=o*(1-d*a),b=o*(1-(1-d)*a);switch(l%6){case 0:return $(o,b,u,c);case 1:return $(m,o,u,c);case 2:return $(u,o,b,c);case 3:return $(u,m,o,c);case 4:return $(b,u,o,c);case 5:return $(o,u,m,c);default:throw new Error("Unable to parse HSV color")}}function Dn(...t){let e=0,s=0,i=0,r=1;if(pi(t))e=t[0],s=t[1],i=t[2],r=t[3]??1;else if(t.length===1){let m=t[0];Array.isArray(m)?(e=m[0],s=m[1],i=m[2],r=m[3]??1):m.h!=null&&m.s!=null&&m.l!=null&&(e=m.h,s=m.s,i=m.l,r=m.a??1)}let n=B(e,0,360)/360,a=B(s,0,1),o=B(i,0,1),c=B(r,0,1),l,d,u;if(a==0)l=d=u=o;else{let m=o<.5?o*(1+a):o+a-o*a,b=2*o-m;l=Vs(b,m,n+1/3),d=Vs(b,m,n),u=Vs(b,m,n-1/3)}return $(l,d,u,c)}function Vs(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+(e-t)*6*s:s<1/2?e:s<2/3?t+(e-t)*(2/3-s)*6:t}function Bn(t){let e=t[0],s=t[1],i=t[2],r=Math.max(e,s,i),n=Math.min(e,s,i),a=r-n,o;if(a==0)o=0;else switch(r){case e:{let c=(s-i)/a,l=0/60;c<0&&(l=360/60),o=c+l;break}case s:{let c=(i-e)/a,l=120/60;o=c+l;break}case i:{let c=(e-s)/a,l=240/60;o=c+l;break}}return o*60}function Wn(t,e=1){let s=t.replace(/^#/,"");s.length==3&&(s=s[0]+s[0]+s[1]+s[1]+s[2]+s[2]);let i=parseInt(s.substring(0,2),16),r=parseInt(s.substring(2,4),16),n=parseInt(s.substring(4,6),16),a=B(e,0,1);return $(i/255,r/255,n/255,a)}function Vn(t,e){let s=B(e,0,1),i=t[0]*(1-s),r=t[1]*(1-s),n=t[2]*(1-s);return[i,r,n,t[3]]}function qn(t,e){let s=B(e,0,1),i=t[0]+(1-t[0])*s,r=t[1]+(1-t[1])*s,n=t[2]+(1-t[2])*s;return[i,r,n,t[3]]}function Gn(t,e){let s=(t[0]+e[0])/2,i=(t[1]+e[1])/2,r=(t[2]+e[2])/2,n=(t[3]+e[3])/2;return[s,i,r,n]}function yr(t,e,s){let i=B(s,0,1);return[z(t[0],e[0],i),z(t[1],e[1],i),z(t[2],e[2],i),z(t[3],e[3],i)]}function pi(t){return t.length===3||t.length===4}var ke=1e-6,ir=Float32Array,vr=new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]),q=vr.get(Float32Array);function Yn(t){let e=ir;return ir=t,q=vr.get(t),e}function Kn(t,e,s,i,r,n,a,o,c){let l=q();return l[3]=0,l[7]=0,l[11]=0,t!==void 0&&(l[0]=t,e!==void 0&&(l[1]=e,s!==void 0&&(l[2]=s,i!==void 0&&(l[4]=i,r!==void 0&&(l[5]=r,n!==void 0&&(l[6]=n,a!==void 0&&(l[8]=a,o!==void 0&&(l[9]=o,c!==void 0&&(l[10]=c))))))))),l}function Xn(t,e,s,i,r,n,a,o,c,l){return l=l||q(),l[0]=t,l[1]=e,l[2]=s,l[3]=0,l[4]=i,l[5]=r,l[6]=n,l[7]=0,l[8]=a,l[9]=o,l[10]=c,l[11]=0,l}function Jn(t,e){return e=e||q(),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e}function fi(t,e){return e=e||q(),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[8]=t[8],e[9]=t[9],e[10]=t[10],e}var wr=fi;function Hn(t,e){return Math.abs(t[0]-e[0])<ke&&Math.abs(t[1]-e[1])<ke&&Math.abs(t[2]-e[2])<ke&&Math.abs(t[4]-e[4])<ke&&Math.abs(t[5]-e[5])<ke&&Math.abs(t[6]-e[6])<ke&&Math.abs(t[8]-e[8])<ke&&Math.abs(t[9]-e[9])<ke&&Math.abs(t[10]-e[10])<ke}function Qn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]}function Pe(t){return t=t||q(),t[0]=1,t[1]=0,t[2]=0,t[4]=0,t[5]=1,t[6]=0,t[8]=0,t[9]=0,t[10]=1,t}function ea(t,e){if(e=e||q(),e===t){let u;return u=t[1],t[1]=t[4],t[4]=u,u=t[2],t[2]=t[8],t[8]=u,u=t[6],t[6]=t[9],t[9]=u,e}let s=t[0*4+0],i=t[0*4+1],r=t[0*4+2],n=t[1*4+0],a=t[1*4+1],o=t[1*4+2],c=t[2*4+0],l=t[2*4+1],d=t[2*4+2];return e[0]=s,e[1]=n,e[2]=c,e[4]=i,e[5]=a,e[6]=l,e[8]=r,e[9]=o,e[10]=d,e}function mi(t,e){e=e||q();let s=t[0*4+0],i=t[0*4+1],r=t[0*4+2],n=t[1*4+0],a=t[1*4+1],o=t[1*4+2],c=t[2*4+0],l=t[2*4+1],d=t[2*4+2],u=d*a-o*l,m=-d*n+o*c,b=l*n-a*c,S=1/(s*u+i*m+r*b);return e[0]=u*S,e[1]=(-d*i+r*l)*S,e[2]=(o*i-r*a)*S,e[4]=m*S,e[5]=(d*s-r*c)*S,e[6]=(-o*s+r*n)*S,e[8]=b*S,e[9]=(-l*s+i*c)*S,e[10]=(a*s-i*n)*S,e}function ta(t){let e=t[0],s=t[0*4+1],i=t[0*4+2],r=t[1*4+0],n=t[1*4+1],a=t[1*4+2],o=t[2*4+0],c=t[2*4+1],l=t[2*4+2];return e*(n*l-c*a)-r*(s*l-c*i)+o*(s*a-n*i)}var sa=mi;function br(t,e,s){s=s||q();let i=t[0],r=t[1],n=t[2],a=t[4],o=t[5],c=t[6],l=t[8],d=t[9],u=t[10],m=e[0],b=e[1],S=e[2],U=e[4],F=e[5],ne=e[6],R=e[8],ee=e[9],de=e[10];return s[0]=i*m+a*b+l*S,s[1]=r*m+o*b+d*S,s[2]=n*m+c*b+u*S,s[4]=i*U+a*F+l*ne,s[5]=r*U+o*F+d*ne,s[6]=n*U+c*F+u*ne,s[8]=i*R+a*ee+l*de,s[9]=r*R+o*ee+d*de,s[10]=n*R+c*ee+u*de,s}var cs=br;function ia(t,e,s){return s=s||Pe(),t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[4]=t[4],s[5]=t[5],s[6]=t[6]),s[8]=e.x,s[9]=e.y,s[10]=1,s}function ra(t,e){return e=e||{x:0,y:0},e.x=t[8],e.y=t[9],e}function xr(t,e,s){s=s||{x:0,y:0};let i=e*4;return s.x=t[i+0],s.y=t[i+1],s}function na(t,e,s,i){i!==t&&(i=fi(t,i));let r=s*4;return i[r+0]=e.x,i[r+1]=e.y,i}function aa(t,e){e=e||{x:0,y:0};let s=t[0],i=t[1],r=t[4],n=t[5];return e.x=Math.sqrt(s*s+i*i),e.y=Math.sqrt(r*r+n*n),e}function gi(t,e){return e=e||q(),e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=t.x,e[9]=t.y,e[10]=1,e}function Xe(t,e,s){s=s||q();let i=e.x,r=e.y,n=t[0],a=t[1],o=t[2],c=t[1*4+0],l=t[1*4+1],d=t[1*4+2],u=t[2*4+0],m=t[2*4+1],b=t[2*4+2];return t!==s&&(s[0]=n,s[1]=a,s[2]=o,s[4]=c,s[5]=l,s[6]=d),s[8]=n*i+c*r+u,s[9]=a*i+l*r+m,s[10]=o*i+d*r+b,s}function oa(t,e){e=e||q();let s=Math.cos(t),i=Math.sin(t);return e[0]=s,e[1]=i,e[2]=0,e[4]=-i,e[5]=s,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function gt(t,e,s){s=s||q();let i=t[0*4+0],r=t[0*4+1],n=t[0*4+2],a=t[1*4+0],o=t[1*4+1],c=t[1*4+2],l=Math.cos(e),d=Math.sin(e);return s[0]=l*i+d*a,s[1]=l*r+d*o,s[2]=l*n+d*c,s[4]=l*a-d*i,s[5]=l*o-d*r,s[6]=l*c-d*n,t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10]),s}function la(t,e){return e=e||q(),e[0]=t.x,e[1]=0,e[2]=0,e[4]=0,e[5]=t.y,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function Ft(t,e,s){s=s||q();let i=e.x,r=e.y;return s[0]=i*t[0*4+0],s[1]=i*t[0*4+1],s[2]=i*t[0*4+2],s[4]=r*t[1*4+0],s[5]=r*t[1*4+1],s[6]=r*t[1*4+2],t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10]),s}function ca(t,e){return e=e||q(),e[0]=t,e[1]=0,e[2]=0,e[4]=0,e[5]=t,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function ua(t,e,s){return s=s||q(),s[0]=e*t[0*4+0],s[1]=e*t[0*4+1],s[2]=e*t[0*4+2],s[4]=e*t[1*4+0],s[5]=e*t[1*4+1],s[6]=e*t[1*4+2],t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10]),s}var da=Object.freeze(Object.defineProperty({__proto__:null,clone:wr,copy:fi,create:Kn,determinant:ta,equals:Qn,equalsApproximately:Hn,getAxis:xr,getScaling:aa,getTranslation:ra,identity:Pe,inverse:mi,invert:sa,mul:cs,multiply:br,negate:Jn,rotate:gt,rotation:oa,scale:Ft,scaling:la,set:Xn,setAxis:na,setDefaultType:Yn,setTranslation:ia,translate:Xe,translation:gi,transpose:ea,uniformScale:ua,uniformScaling:ca},Symbol.toStringTag,{value:"Module"})),E={getX(t,e){return ze(t),Le(e),t.world.x+(e-t.pivot.x)*t.width*t.scale.x},getY(t,e){return ze(t),Le(e),t.world.y+(e-t.pivot.y)*t.height*t.scale.y},getLocalX(t,e){return ze(t),Le(e),t.x+(e-t.pivot.x)*t.width*t.scale.x},getLocalY(t,e){return ze(t),Le(e),t.y+(e-t.pivot.y)*t.height*t.scale.y},setX(t,e,s){ze(t),Le(e),t.world.x=s-(e-t.pivot.x)*t.width*t.scale.x},setY(t,e,s){ze(t),Le(e),t.world.y=s-(e-t.pivot.y)*t.height*t.scale.y},setLocalX(t,e,s){ze(t),Le(e),t.x=s-(e-t.pivot.x)*t.width*t.scale.x},setLocalY(t,e,s){ze(t),Le(e),t.y=s-(e-t.pivot.y)*t.height*t.scale.y},getPoint(t,e){return{x:E.getX(t,e.x),y:E.getY(t,e.y)}},getLocalPoint(t,e){return{x:E.getLocalX(t,e.x),y:E.getLocalY(t,e.y)}},setPoint(t,e,s){E.setX(t,e.x,s.x),E.setY(t,e.y,s.y)},setLocalPoint(t,e,s){E.setLocalX(t,e.x,s.x),E.setLocalY(t,e.y,s.y)},setPosition(t,e){e.topLeft!=null&&E.setPoint(t,h(0),e.topLeft),e.left!=null&&E.setX(t,0,e.left),e.right!=null&&E.setX(t,1,e.right),e.top!=null&&E.setY(t,0,e.top),e.bottomRight!=null&&E.setPoint(t,h(0,0),e.bottomRight),e.bottom!=null&&E.setY(t,1,e.bottom),e.center!=null&&E.setPoint(t,h(.5),e.center),e.centerX!=null&&E.setX(t,.5,e.centerX),e.centerY!=null&&E.setY(t,.5,e.centerY)}};function Le(t){if(0>t||t>1)throw new Error(`Point must be between 0 and 1, got: ${t}`)}function ze(t){if(t.width==null)throw new Error(`Rect has no width: ${t}`);if(t.height==null)throw new Error(`Rect has no height: ${t}`)}function yi(t){let e=t.parentTransform?yi(t.parentTransform):Pe();return Xe(e,t,e),gt(e,t.rotation,e),Ft(e,t.scale,e),e}function Js(t,e){let s=e?yi(e):Pe();return h(t.x,t.y).transform(s)}function Ue(t,e){let s=e?mi(yi(e)):Pe();return h(t.x,t.y).transform(s)}function ha(t,e){let s=e.pivot??h(.5);return h(t).subtract(s).scale(e.width,e.height)}var pt,Ht=class Oe{constructor(e){if(p(this,"id"),p(this,"x"),p(this,"y"),p(this,"width"),p(this,"height"),p(this,"version",1),G(this,pt,null),p(this,"color"),p(this,"isVisible",!0),p(this,"scale",h(1)),p(this,"rotation",0),p(this,"pivot"),p(this,"skew"),p(this,"texturePath"),p(this,"material"),p(this,"text"),p(this,"textOpts"),p(this,"spriteFrame"),p(this,"colorMap",[]),p(this,"label"),p(this,"tags",[]),p(this,"parent"),p(this,"parentTransform"),p(this,"camera"),p(this,"kids",[]),p(this,"isDestroyed",!1),p(this,"onPosition"),e||(e={}),typeof e=="string"&&(e=JSON.parse(e)),this.id=e.id||ui(),e.texture?(this.texture=e.texture,this.width=e.width??e.texture.width,this.height=e.height??e.texture.height):(this.width=e.width??0,this.height=e.height||this.width),e.text){this.text=e.text,this.textOpts=e.textOpts;let{width:s,height:i}=ks(e.text,e.textOpts);this.width=s,this.height=i}if(this.x=e.x||0,this.y=e.y||0,this.isVisible=e.isVisible??this.isVisible,this.rotation=e.rotation??this.rotation,this.version=e.version??this.version,K(this,pt,e.z??null),this.scale=e.scale?h(e.scale):this.scale,this.pivot=e.pivot?h(e.pivot):Oe.defaultPivot,this.skew=e.skew?e.skew:h(0),this.label=e.label,this.tags=typeof e.tags=="string"?e.tags.split(" "):e.tags??[],this.texturePath=e.texturePath??this.texturePath,this.spriteFrame=e.spriteFrame,this.color=e.color??(this.texturePath?D.WHITE:D.MAGENTA),this.material=e.material,this.colorMap=e.colorMap??[],this.parent=e.parent,this.camera=e.camera,e.text&&e.texturePath)throw new Error(`Gob ${e.id} can't have both text and texturePath yet`);E.setPosition(this,e),e.onPosition&&(this.onPosition=e.onPosition,e.parent&&e.onPosition(this,e.parent)),this.kids=(e.kids||[]).map(s=>{let i;return s instanceof Oe?i=s:i=new Oe({...s,z:s.z,parent:this}),i.parent=this,i.onPosition&&i.onPosition(i,this),i})}set texture(e){this.texturePath=e.path,this.width=e.width,this.height=e.height}get transform(){let e=this,s={x:e.x,y:e.y,rotation:e.rotation,scale:e.scale,skew:e.skew},i=s;for(;e.parent;)e=e.parent,i.parentTransform={x:e.x,y:e.y,rotation:e.rotation,scale:e.scale,skew:e.skew},i=i.parentTransform;return s}get transformMatrix(){var e;let s=((e=this.parent)==null?void 0:e.transformMatrix)??Pe();return Xe(s,this,s),this.applySkewScaleRotation(s),s}applySkewScaleRotation(e){let s=Pe();s[0]=Math.cos(this.rotation+this.skew.y)*this.scale.x,s[1]=Math.sin(this.rotation+this.skew.y)*this.scale.x,s[4]=-Math.sin(this.rotation+this.skew.x)*this.scale.y,s[5]=Math.cos(this.rotation+this.skew.x)*this.scale.y,cs(e,s,e)}get isVisibleInTree(){return this.parent&&!this.parent.isVisibleInTree?!1:this.isVisible}get z(){return O(this,pt)!=null?O(this,pt):this.parent?this.parent.z:0}set z(e){K(this,pt,e)}bounds(){return[Se(h(0,0),this),Se(h(1,0),this),Se(h(1,1),this),Se(h(0,1),this)]}static revive(e){return new Oe(e)}static fromJSON(e){return new Oe(e)}toJSON(){return{...this,z:this.z,__serializedName:Oe.serializableName,isDestroyed:void 0,parent:void 0}}destroy(){this.isDestroyed=!0;for(let e of this.kids)e.destroy()}addKid(e){return this.add(e)}add(e){if(e instanceof Oe||(e.parent=this,e=new Oe(e)),e.id&&this.find(e.id))throw new Error(`Can't add kid with duplicate id ${e.id}. Matching kid: ${JSON.stringify(this.find(e.id))}`);return e.parent=this,this.kids.push(e),e.onPosition&&e.onPosition(e,this),e}find(e){return _r(this,e)}hasTag(e){return this.tags!=null&&this.tags.includes(e)}findTag(e){return kr(this,e)}findVisible(){return Or(this)}all(e){return Sr(this,e)}set pos(e){this.x=e.x,this.y=e.y}get pos(){return{x:this.x,y:this.y}}get world(){let e=this;return{get pos(){return{x:e.world.x,y:e.world.y}},set pos({x:s,y:i}){e.world.x=s,e.world.y=i},get x(){return Js(h(e.x,e.y),e.transform.parentTransform).x},set x(s){e.x=Ue(h(s),e.transform.parentTransform).x},get y(){return Js(h(e.x,e.y),e.transform.parentTransform).y},set y(s){e.y=Ue(h(s),e.transform.parentTransform).y},get width(){return e.width*e.world.scale.x},set width(s){e.width=s/e.world.scale.x},get height(){return e.height*e.world.scale.y},set height(s){e.height=s/e.world.scale.y},get scale(){var s;let i=((s=e.parent)==null?void 0:s.world.scale)??h(1);return h(e.scale).mul(i)},set scale(s){var i;let r=((i=e.parent)==null?void 0:i.world.scale)??h(1);e.scale=h(s).div(r)},get rotation(){return e.parent?rr(e.transformMatrix):e.rotation},set rotation(s){if(!e.parent){e.rotation=s;return}let i=gi(e);Ft(i,e.scale,i),gt(i,e.rotation,i),gt(i,-e.world.rotation,i),e.rotation=rr(gt(i,s))}}}get topLeft(){return Se(h(0,0),this)}set topLeft(e){this.top=e.y,this.left=e.x}get topRight(){return Se(h(1,0),this)}set topRight(e){this.top=e.y,this.right=e.x}get bottomRight(){return Se(h(1,1),this)}set bottomRight(e){this.bottom=e.y,this.right=e.x}get bottomLeft(){return Se(h(0,1),this)}set bottomLeft(e){this.bottom=e.y,this.left=e.x}get center(){return Se(h(.5,.5),this)}set center(e){this.centerX=e.x,this.centerY=e.y}get top(){return this.topLeft.y}set top(e){let s=e-(0-this.pivot.y)*this.world.height;this.y=Ue(h(s),this.transform.parentTransform).y}get bottom(){return this.bottomLeft.y}set bottom(e){let s=e-(1-this.pivot.y)*this.world.height;this.y=Ue(h(s),this.transform.parentTransform).y}get left(){return this.topLeft.x}set left(e){let s=e-(0-this.pivot.x)*this.world.width;this.x=Ue(h(s),this.transform.parentTransform).x}get right(){return this.topRight.x}set right(e){let s=e-(1-this.pivot.x)*this.world.width;this.x=Ue(h(s),this.transform.parentTransform).x}get centerX(){return this.center.x}set centerX(e){let s=e-(.5-this.pivot.x)*this.world.width;this.x=Ue(h(s),this.transform.parentTransform).x}get centerY(){return this.center.y}set centerY(e){let s=e-(.5-this.pivot.y)*this.world.height;this.y=Ue(h(s),this.transform.parentTransform).y}};pt=new WeakMap,p(Ht,"serializedName","Gob.v1"),p(Ht,"defaultPivot",h(.5)),p(Ht,"serializableName","Gob.v1");var Q=Ht;function _r(t,e){if(t.id===e)return t;for(let s of t.kids){let i=_r(s,e);if(i)return i}return null}function kr(t,e){let s=[];t.tags.includes(e)&&s.push(t);for(let i of t.kids)s.push(...kr(i,e));return s}function Sr(t,e){let s=[];e(t)&&s.push(t);for(let i of t.kids)s.push(...Sr(i,e));return s}function Or(t){let e=[];t.isVisible&&e.push(t);for(let s of t.kids)s.isVisible&&e.push(...Or(s));return e}function Se(t,e){return Js(ha(t,e),e.transform)}function rr(t){let e=xr(t,0);return Math.atan2(e.y,e.x)}var Hs=class Qt{constructor(e){p(this,"x"),p(this,"y"),p(this,"z"),p(this,"color"),p(this,"width"),p(this,"height"),p(this,"rotation"),p(this,"scale"),p(this,"skew"),p(this,"pivot"),p(this,"camera"),this.x=e.x??0,this.y=e.y??0,this.z=e.z??0,this.width=e.width,this.height=e.height||e.width,this.scale=e.scale?h(e.scale):h(1),this.skew=e.skew?e.skew:h(0),this.pivot=e.pivot?h(e.pivot):Qt.defaultPivot,this.rotation=e.rotation||0,this.color=e.color||[1,0,1,1],this.camera=e.camera,E.setPosition(this,e)}get world(){let e=this;return{get position(){return{x:e.world.x,y:e.world.y}},set position({x:s,y:i}){e.world.x=s,e.world.y=i},get x(){return e.x},set x(s){e.x=s},get y(){return e.y},set y(s){e.y=s}}}bounds(){let e=this.pivot.scale(this.width,this.height),s=[h(0,0),h(this.width,0),h(this.width,this.height),h(0,this.height)].map(o=>o.subtract(e).scale(this.scale).rotate(this.rotation).add(this.x,this.y)),i=1/0,r=-1/0,n=1/0,a=-1/0;for(let o of s)i=Math.min(i,o.x),r=Math.max(r,o.x),n=Math.min(n,o.y),a=Math.max(a,o.y);return{points:s,x1:i,x2:r,y1:n,y2:a}}static fromJSON(e){return new Qt(e)}toJSON(){return{...this,__serializedName:Qt.serializedName}}get top(){return E.getY(this,0)}set top(e){E.setY(this,0,e)}get bottom(){return E.getY(this,1)}set bottom(e){E.setY(this,1,e)}get left(){return E.getX(this,0)}set left(e){E.setX(this,0,e)}get right(){return E.getX(this,1)}set right(e){E.setX(this,1,e)}get centerX(){return E.getX(this,.5)}set centerX(e){E.setX(this,.5,e)}get centerY(){return E.getY(this,.5)}set centerY(e){E.setY(this,.5,e)}get topLeft(){return E.getPoint(this,h(0))}set topLeft(e){E.setPoint(this,h(0),e)}get topRight(){return E.getPoint(this,h(1,0))}set topRight(e){E.setPoint(this,h(1,0),e)}get bottomRight(){return E.getPoint(this,h(1))}set bottomRight(e){E.setPoint(this,h(1),e)}get bottomLeft(){return E.getPoint(this,h(0,1))}set bottomLeft(e){E.setPoint(this,h(0,1),e)}get center(){return E.getPoint(this,h(.5))}set center(e){E.setPoint(this,h(.5),e)}};p(Hs,"defaultPivot",h(.5)),p(Hs,"serializedName","Rect.v1");var Os=Hs;function jt(){return{keyboard:{down:new Set,up:new Set},mouse:{down:new Set,up:new Set,x:0,y:0},gamepads:[]}}function vi(t){return{keyboard:{down:new Set(t.keyboard.down),up:new Set(t.keyboard.up)},mouse:{down:new Set(t.mouse.down),up:new Set(t.mouse.up),x:t.mouse.x,y:t.mouse.y},gamepads:t.gamepads.map(pa)}}function pa(t){return{index:t.index,id:t.id,vendorId:t.vendorId,productId:t.productId,down:new Set(t.down),up:new Set(t.up),buttons:t.buttons.map(e=>({value:e.value,label:e.label,position:e.position})),axes:t.axes.map(e=>({value:e.value,hand:e.hand}))}}var ut=(t=>(t[t.Null=0]="Null",t[t.Left=1]="Left",t[t.Right=2]="Right",t))(ut||{}),Et=(t=>(t[t.Null=0]="Null",t[t.Gamepad=1]="Gamepad",t[t.Touch=2]="Touch",t[t.Mouse=3]="Mouse",t[t.Keyboard=4]="Keyboard",t[t.Custom=5]="Custom",t))(Et||{}),wi=(t=>(t[t.Null=0]="Null",t[t.LeftFaceTop=1]="LeftFaceTop",t[t.LeftFaceRight=2]="LeftFaceRight",t[t.LeftFaceBottom=3]="LeftFaceBottom",t[t.LeftFaceLeft=4]="LeftFaceLeft",t[t.LeftShoulderFront=5]="LeftShoulderFront",t[t.LeftShoulderBack=6]="LeftShoulderBack",t[t.LeftThumbstick=7]="LeftThumbstick",t[t.RightFaceTop=8]="RightFaceTop",t[t.RightFaceRight=9]="RightFaceRight",t[t.RightFaceBottom=10]="RightFaceBottom",t[t.RightFaceLeft=11]="RightFaceLeft",t[t.RightShoulderFront=12]="RightShoulderFront",t[t.RightShoulderBack=13]="RightShoulderBack",t[t.RightThumbstick=14]="RightThumbstick",t[t.Middle=15]="Middle",t[t.MiddleLeft=16]="MiddleLeft",t[t.MiddleRight=17]="MiddleRight",t))(wi||{}),j=(t=>(t[t.Null=0]="Null",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Middle=3]="Middle",t))(j||{}),Tr=(t=>(t[t.Null=0]="Null",t[t.ArrowDown=1]="ArrowDown",t[t.ArrowLeft=2]="ArrowLeft",t[t.ArrowRight=3]="ArrowRight",t[t.ArrowUp=4]="ArrowUp",t[t.Backspace=5]="Backspace",t[t.Tab=6]="Tab",t[t.CapsLock=7]="CapsLock",t[t.Enter=8]="Enter",t[t.ShiftLeft=9]="ShiftLeft",t[t.ShiftRight=10]="ShiftRight",t[t.ControlLeft=11]="ControlLeft",t[t.MetaLeft=12]="MetaLeft",t[t.AltLeft=13]="AltLeft",t[t.Space=14]="Space",t[t.AltRight=15]="AltRight",t[t.MetaRight=16]="MetaRight",t[t.ContextMenu=17]="ContextMenu",t[t.ControlRight=18]="ControlRight",t[t.Backquote=19]="Backquote",t[t.Digit1=20]="Digit1",t[t.Digit2=21]="Digit2",t[t.Digit3=22]="Digit3",t[t.Digit4=23]="Digit4",t[t.Digit5=24]="Digit5",t[t.Digit6=25]="Digit6",t[t.Digit7=26]="Digit7",t[t.Digit8=27]="Digit8",t[t.Digit9=28]="Digit9",t[t.Digit0=29]="Digit0",t[t.Minus=30]="Minus",t[t.Equal=31]="Equal",t[t.IntlYen=32]="IntlYen",t[t.Q=33]="Q",t[t.W=34]="W",t[t.E=35]="E",t[t.R=36]="R",t[t.T=37]="T",t[t.Y=38]="Y",t[t.U=39]="U",t[t.I=40]="I",t[t.O=41]="O",t[t.P=42]="P",t[t.BracketLeft=43]="BracketLeft",t[t.BracketRight=44]="BracketRight",t[t.Backslash=45]="Backslash",t[t.A=46]="A",t[t.S=47]="S",t[t.D=48]="D",t[t.F=49]="F",t[t.G=50]="G",t[t.H=51]="H",t[t.J=52]="J",t[t.K=53]="K",t[t.L=54]="L",t[t.Semicolon=55]="Semicolon",t[t.Quote=56]="Quote",t[t.IntlBackslash=57]="IntlBackslash",t[t.Z=58]="Z",t[t.X=59]="X",t[t.C=60]="C",t[t.V=61]="V",t[t.B=62]="B",t[t.N=63]="N",t[t.M=64]="M",t[t.Comma=65]="Comma",t[t.Period=66]="Period",t[t.Slash=67]="Slash",t[t.IntlRo=68]="IntlRo",t[t.Escape=69]="Escape",t))(Tr||{});function fa(t){let e;t instanceof ArrayBuffer?e=new Uint8Array(t):e=t;let s="0x";return e.forEach(i=>{let r=i.toString(16);r.length<2&&(r="0"+r),s+=r}),s}function ma(t){return Array.from(t).map(e=>("00000000"+e.toString(2)).slice(-8)).join(" ")}function Nt(t,e,s){return new Uint8Array(t.buffer,t.byteOffset+e,s)}var $e=class{constructor(e,s=0){p(this,"offset"),p(this,"bitOffset"),p(this,"dataView"),p(this,"decoder"),p(this,"bytes"),this.offset=s,this.bitOffset=0,this.bytes=e,this.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),this.decoder=new TextDecoder}peek(){return this.offset<this.bytes.length}readBool(){let e=!!(this.dataView.getUint8(this.offset)&1<<this.bitOffset++);return this.bitOffset==8&&(this.bitOffset=0,this.offset++),e}readByte(){return this.readUint8()}readUint8(){return this.getNextOffset(1),this.dataView.getUint8(this.offset++)}readUint16(){this.getNextOffset(2);let e=this.dataView.getUint16(this.offset,!0);return this.offset+=2,e}readInt16(){this.getNextOffset(2);let e=this.dataView.getInt16(this.offset,!0);return this.offset+=2,e}readUint32(){this.getNextOffset(4);let e=this.dataView.getUint32(this.offset,!0);return this.offset+=4,e}readDouble(){this.getNextOffset(8);let e=this.dataView.getFloat64(this.offset,!0);return this.offset+=8,e}readFloat(){this.getNextOffset(4);let e=this.dataView.getFloat32(this.offset,!0);return this.offset+=4,e}readString(){this.getNextOffset(4);let e=this.readUint32(),s=Nt(this.bytes,this.offset,e),i=this.decoder.decode(s);return this.offset+=e,i}getNextOffset(e){if(this.bitOffset>0&&(this.bitOffset=0,this.offset++),this.offset+e>this.bytes.length)throw new Error(`Tried to read ${e} bytes, but only ${this.bytes.length-this.offset} remain`)}},Ke=class{constructor(e,s=0){p(this,"buffer"),p(this,"offset"),p(this,"bitOffset"),p(this,"dataView"),p(this,"encoder"),this.buffer=typeof e=="number"?new Uint8Array(e):e??new Uint8Array,this.dataView=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),this.offset=s,this.bitOffset=0,this.encoder=new TextEncoder}writeBool(e){this.buffer[this.offset]|=(e?1:0)<<this.bitOffset++,this.bitOffset==8&&(this.offset++,this.bitOffset=0)}writeUInt8(e){if(256<=e||e<0)throw new Error(`OverflowException: Tried to write byte ${e}, must be 0-255`);this.checkOffsets(1),this.dataView.setUint8(this.offset,e),this.offset+=1}writeUInt16(e){if(65536<=e||e<0)throw new Error(`OverflowException: Tried to write ushort ${e}, must be 0-65535`);this.checkOffsets(2),this.dataView.setUint16(this.offset,e,!0),this.offset+=2}writeInt16(e){if(32768<=e||e<-32768)throw new Error(`OverflowException: Tried to write short ${e}, must be -32768-32767`);this.checkOffsets(2),this.dataView.setInt16(this.offset,e,!0),this.offset+=2}writeUInt32(e){if(4294967295<e||e<0)throw new Error(`OverflowException: Tried to write uint ${e}, must be 0-4294967295`);this.checkOffsets(4),this.dataView.setUint32(this.offset,e,!0),this.offset+=4}writeByte(e){this.writeUInt8(e)}writeFloat(e){this.checkOffsets(4),this.dataView.setFloat32(this.offset,e,!0),this.offset+=4}writeDouble(e){this.checkOffsets(8),this.dataView.setFloat64(this.offset,e,!0),this.offset+=8}writeString(e){let s=this.encoder.encode(e);this.writeUInt32(s.length),this.checkOffsets(s.length),this.buffer.set(s,this.offset),this.offset+=s.length}checkOffsets(e){if(this.bitOffset>0&&(this.offset++,this.bitOffset=0),this.offset+e>this.buffer.length)throw new Error(`Tried to write ${e} bytes but we only have ${this.buffer.length-this.offset} left.`)}},us=20,ds=2,bi=4,hs=1+16*2,nr=128,qs=hs,Qs=6,ga=1,Gs=hs+Qs,Ee=class t{static encodeSnapshot(e,s,i){t.encodeKeyboard(e,s.keyboard,i),t.encodeMouse(e,s.mouse,i),t.encodeGamepads(e,s.gamepads,i)}static decodeSnapshot(e,s,i){return s??(s=jt()),t.decodeKeyboard(e,s.keyboard,i),t.decodeMouse(e,s.mouse,i),t.decodeGamepads(e,s.gamepads,i),s}static encodeKeyboard(e,s,i){let{down:r,up:n}=s;i??(i=new Ke(Nt(e,0,hs))),i.writeUInt8(Et.Keyboard);for(let a=0;a<nr;a++)i.writeBool(r.has(a)),i.writeBool(n.has(a));return i.buffer}static decodeKeyboard(e,s,i){s??(s={down:new Set,up:new Set}),i??(i=new $e(e,0));let r=i.readUint8();if(r!==Et.Keyboard)throw new Error(`Expected to read keyboard input at current position, got: ${r}`);for(let n=0;n<nr;n++)i.readBool()&&s.down.add(n),i.readBool()&&s.up.add(n);return s}static encodeMouse(e,s,i){return i??(i=new Ke(Nt(e,qs,Qs))),i.writeUInt8(Et.Mouse),i.writeInt16(s.x),i.writeInt16(s.y),i.writeBool(s.down.has(j.Left)),i.writeBool(s.up.has(j.Left)),i.writeBool(s.down.has(j.Right)),i.writeBool(s.up.has(j.Right)),i.writeBool(s.down.has(j.Middle)),i.writeBool(s.up.has(j.Middle)),i.buffer}static decodeMouse(e,s,i){if(s??(s={x:0,y:0,down:new Set,up:new Set}),i??(i=new $e(e,qs)),i.readUint8()!=Et.Mouse)throw new Error(`Expected to read mouse input at position ${qs}: ${e}`);return s.x=i.readInt16(),s.y=i.readInt16(),i.readBool()&&s.down.add(j.Left),i.readBool()&&s.up.add(j.Left),i.readBool()&&s.down.add(j.Right),i.readBool()&&s.up.add(j.Right),i.readBool()&&s.down.add(j.Middle),i.readBool()&&s.up.add(j.Middle),s}static byteLength(e=us,s=ds,i=bi){return hs+Qs+ga+this.gamepadByteLength(e,s)*i}static gamepadByteLength(e=us,s=ds){return 3+9*e+17*s+2+e+e}static encodeGamepads(e,s,i){let r=Gs;i??(i=new Ke(e,r)),i.writeByte(s.length);for(let n=0;n<s.length;n++)t.encodeGamepad(e,s[n],i)}static encodeGamepad(e,s,i){i.writeUInt8(s.index),i.writeUInt8(s.buttons.length),i.writeUInt8(s.axes.length);for(let r of s.buttons)i.writeUInt8(r.position??wi.Null),i.writeDouble(r.value);for(let r of s.axes)i.writeByte(r.hand??ut.Null),i.writeDouble(r.value[0]),i.writeDouble(r.value[1]);i.writeUInt8(s.down.size),i.writeUInt8(s.up.size);for(let r of s.down)i.writeUInt8(r);for(let r of s.up)i.writeUInt8(r);return i.buffer}static decodeGamepads(e,s,i){s??(s=[]);let r=Gs;i??(i=new $e(e,Gs));let n=i.readByte();for(;s.length>n;)s.pop();for(let a=0;a<n;a++)s[a]=t.decodeGamepad(e.subarray(r),s[a],i);return s}static decodeGamepad(e,s,i){s??(s={index:0,axes:[],buttons:[],down:new Set,up:new Set}),i??(i=new $e(e)),s.index=i.readUint8();let r=i.readUint8(),n=i.readUint8();for(let c=0;c<r;c++){let l=i.readUint8(),d=i.readDouble(),u=ya(s,c,l);u.position=l,u.value=d}for(let c=0;c<n;c++){let l=i.readUint8(),d=i.readDouble(),u=i.readDouble(),m=va(s,c,l);m.hand=l,m.value=[d,u]}let a=i.readUint8(),o=i.readUint8();for(let c=0;c<a;c++)s.down.add(i.readUint8());for(let c=0;c<o;c++)s.up.add(i.readUint8());return s}};function ya(t,e,s){let i=t.buttons[e]||t.buttons.find(r=>r.position===s);return i||(i={position:s,value:0},t.buttons.push(i)),i}function va(t,e,s){let i=t.axes[e]||t.axes.find(r=>r.hand===s);return i||(i={value:[0,0],hand:s},t.axes.push(i)),i}var wa=["aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","canidae","capybara","cardinal","caribou","carp","cat","caterpillar","catfish","catshark","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","cicada","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragon","dragonfly","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","felidae","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","galliform","gamefowl","gayal","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","unicorn","urial","vicuna","viper","vole","vulture","wallaby","walrus","warbler","wasp","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra"],ba=["able","above","absent","absolute","abstract","abundant","academic","acceptable","accepted","accessible","accurate","accused","active","actual","acute","added","additional","adequate","adjacent","administrative","adorable","advanced","adverse","advisory","aesthetic","afraid","afraid","african","aggregate","aggressive","agreeable","agreed","agricultural","alert","alive","alive","alleged","allied","alone","alright","alternative","amateur","amazing","ambitious","american","amused","ancient","ancient","angry","angry","annoyed","annual","anonymous","anxious","anxious","appalling","apparent","applicable","appropriate","arab","arbitrary","architectural","armed","arrogant","artificial","artistic","ashamed","ashamed","asian","asleep","assistant","associated","atomic","attractive","australian","automatic","autonomous","available","average","average","average","awake","aware","awful","awful","awkward","back","bad","bad","bad","balanced","bare","basic","beautiful","beautiful","beautiful","beneficial","better","bewildered","big","big","big","binding","biological","bitter","bitter","bizarre","black","black","blank","blind","blonde","bloody","bloody","blue","blue","blushing","boiling","bold","bored","bored","boring","bottom","brainy","brave","brave","breakable","breezy","brief","brief","bright","bright","bright","brilliant","british","broad","broad","broken","broken","brown","bumpy","burning","busy","busy","calm","calm","canadian","capable","capitalist","careful","careful","casual","catholic","causal","cautious","cautious","central","certain","changing","characteristic","charming","charming","cheap","cheerful","cheerful","chemical","chief","chilly","chinese","chosen","christian","chronic","chubby","circular","civic","civil","civilian","classic","classical","clean","clean","clear","clear","clever","clever","clinical","close","closed","cloudy","clumsy","coastal","cognitive","coherent","cold","cold","collective","colonial","colorful","colossal","coloured","colourful","combative","combined","comfortable","comfortable","coming","commercial","common","communist","compact","comparable","comparative","compatible","competent","competitive","complete","complex","complicated","comprehensive","compulsory","conceptual","concerned","concerned","concrete","condemned","confident","confidential","confused","confused","conscious","conservation","conservative","considerable","consistent","constant","constitutional","contemporary","content","continental","continued","continuing","continuous","controlled","controversial","convenient","conventional","convinced","convincing","cooing","cool","cool","cooperative","corporate","correct","corresponding","costly","courageous","crazy","crazy","crazy","creative","creepy","creepy","criminal","critical","crooked","crooked","crowded","crucial","crude","cruel","cruel","cuddly","cultural","curious","curious","curly","current","curved","cute","daily","damaged","damp","damp","dangerous","dangerous","dark","dark","dead","dead","deaf","deafening","dear","decent","decisive","deep","deep","defeated","defensive","defiant","definite","deliberate","delicate","delicious","delicious","delighted","delightful","delightful","democratic","dependent","depressed","depressed","desirable","desperate","detailed","determined","determined","developed","developing","devoted","different","different","difficult","difficult","digital","diplomatic","direct","dirty","dirty","disabled","disappointed","disastrous","disciplinary","disgusted","distant","distinct","distinct","distinctive","distinguished","disturbed","disturbing","diverse","divine","dizzy","domestic","dominant","double","doubtful","doubtful","drab","dramatic","dreadful","driving","drunk","dry","dry","dual","due","dull","dull","dull","dusty","dutch","dying","dynamic","eager","eager","early","early","eastern","easy","easy","economic","educational","eerie","effective","efficient","elaborate","elated","elderly","eldest","electoral","electric","electrical","electronic","elegant","elegant","eligible","embarrassed","embarrassed","embarrassing","emotional","empirical","empty","empty","enchanting","encouraging","encouraging","endless","energetic","english","enormous","enthusiastic","enthusiastic","entire","entitled","envious","environmental","equal","equivalent","essential","established","estimated","ethical","ethnic","european","eventual","everyday","evident","evil","evil","evolutionary","exact","excellent","exceptional","excess","excessive","excited","excited","exciting","exclusive","existing","exotic","expected","expensive","experienced","experimental","explicit","extended","extensive","external","extra","extraordinary","extreme","exuberant","faint","faint","fair","fair","faithful","faithful","familiar","famous","famous","fancy","fantastic","fantastic","far","fascinating","fashionable","fast","fast","fat","fat","fat","fatal","favourable","favourite","federal","fellow","female","feminist","few","fierce","fierce","filthy","filthy","final","financial","fine","fine","firm","fiscal","fit","fixed","flaky","flat","flat","flexible","fluffy","fluttering","flying","following","fond","foolish","foolish","foreign","formal","formidable","forthcoming","fortunate","forward","fragile","frail","frantic","free","french","frequent","fresh","fresh","friendly","friendly","friendly","frightened","frightened","front","frozen","fucking","full","full-time","fun","functional","fundamental","funny","funny","funny","furious","future","fuzzy","gastric","gay","general","generous","genetic","gentle","gentle","genuine","geographical","german","giant","giant","gigantic","gigantic","given","glad","glamorous","gleaming","global","glorious","glorious","golden","good","good","gorgeous","gothic","governing","graceful","gradual","grand","grateful","greasy","great","great","great","greek","green","green","grey","grieving","grim","gross","grotesque","growing","grubby","grumpy","guilty","handicapped","handsome","handsome","happy","happy","happy","hard","hard","harsh","harsh","head","healthy","healthy","heavy","heavy","helpful","helpful","helpful","helpless","helpless","hidden","high","high","high-pitched","hilarious","hissing","historic","historical","hollow","holy","homeless","homeless","homely","hon","honest","horizontal","horrible","horrible","hostile","hot","hot","huge","huge","human","hungry","hungry","hurt","hushed","husky","icy","ideal","identical","ideological","ill","ill","illegal","imaginative","immediate","immense","immense","imperial","implicit","important","important","impossible","impossible","impressed","impressive","improved","inadequate","inappropriate","inc","inclined","increased","increasing","incredible","independent","indian","indirect","individual","industrial","inevitable","influential","informal","inherent","initial","injured","inland","inner","innocent","innocent","innovative","inquisitive","instant","institutional","insufficient","intact","integral","integrated","intellectual","intelligent","intense","intensive","interested","interesting","interim","interior","intermediate","internal","international","intimate","invisible","involved","iraqi","irish","irrelevant","islamic","isolated","israeli","italian","itchy","japanese","jealous","jewish","jittery","joint","jolly","jolly","joyous","judicial","juicy","junior","just","keen","key","kind","kind","kind","known","korean","labour","large","large","large-scale","late","late","latin","lazy","leading","left","legal","legislative","legitimate","lengthy","lesser","level","lexical","liable","liberal","light","light","light","like","likely","limited","linear","linguistic","liquid","literary","little","little","live","lively","lively","living","local","logical","lonely","lonely","long","long","long","long","long-term","loose","loose","lost","loud","loud","lovely","lovely","low","low","loyal","ltd","lucky","lucky","mad","magenta","magic","magnetic","magnificent","magnificent","main","major","male","mammoth","managerial","managing","manual","many","many","marginal","marine","marked","married","marvellous","marxist","mass","massive","massive","mathematical","mature","maximum","mean","meaningful","mechanical","medical","medieval","melodic","melted","mental","mere","metropolitan","mid","middle","middle-class","mighty","mighty","mild","military","miniature","minimal","minimum","ministerial","minor","miserable","misleading","missing","misty","mixed","moaning","mobile","moderate","modern","modern","modern","modest","molecular","monetary","monthly","moral","motionless","muddy","multiple","mushy","musical","mute","mutual","mysterious","mysterious","naked","narrow","narrow","nasty","nasty","national","native","natural","naughty","naval","near","nearby","neat","necessary","negative","neighbouring","nervous","nervous","net","neutral","new","new","nice","nice","nineteenth-century","noble","noisy","noisy","normal","northern","nosy","notable","novel","nuclear","numerous","numerous","nursing","nutritious","nutty","obedient","objective","obliged","obnoxious","obvious","occasional","occupational","odd","odd","official","ok","okay","old","old","old-fashioned","old-fashioned","olympic","only","open","open","operational","opposite","optimistic","oral","orange","orange","ordinary","ordinary","organic","organisational","original","orthodox","other","outdoor","outer","outrageous","outside","outstanding","outstanding","overall","overseas","overwhelming","painful","pale","palestinian","panicky","parallel","parental","parliamentary","part-time","partial","particular","passing","passive","past","patient","payable","peaceful","peculiar","perfect","perfect","permanent","persistent","personal","petite","philosophical","physical","pink","plain","plain","planned","plastic","pleasant","pleasant","pleased","poised","polish","polite","political","poor","poor","popular","positive","possible","post-war","potential","powerful","powerful","practical","precious","precious","precise","preferred","pregnant","preliminary","premier","prepared","present","presidential","pretty","pretty","previous","prickly","prickly","primary","prime","primitive","principal","printed","prior","private","probable","productive","professional","profitable","profound","progressive","prominent","promising","proper","proposed","prospective","protective","protestant","proud","proud","provincial","psychiatric","psychological","public","puny","pure","purple","purple","purring","puzzled","puzzled","quaint","quaint","qualified","quick","quick","quick","quickest","quiet","quiet","quiet","racial","radical","rainy","rainy","random","rapid","rapid","rare","rare","raspy","rational","ratty","raw","ready","real","real","realistic","rear","reasonable","recent","red","red","reduced","redundant","regional","registered","regular","regulatory","related","relative","relaxed","relevant","reliable","relieved","relieved","religious","reluctant","remaining","remarkable","remote","renewed","representative","repulsive","required","resident","residential","resonant","respectable","respective","responsible","resulting","retail","retired","revolutionary","rich","rich","ridiculous","right","rigid","ripe","rising","rival","roasted","robust","rolling","roman","romantic","rotten","rough","rough","round","round","round","royal","rubber","rude","ruling","running","rural","russian","sacred","sad","sad","safe","salty","satisfactory","satisfied","scared","scary","scary","scattered","scientific","scornful","scottish","scrawny","screeching","secondary","secret","secure","select","selected","selective","selfish","semantic","senior","sensible","sensitive","separate","serious","severe","sexual","shaggy","shaky","shallow","shallow","shared","sharp","sharp","sheer","shiny","shivering","shocked","short","short","short","short","short-term","shrill","shy","shy","sick","significant","silent","silent","silky","silly","silly","silly","similar","simple","single","skilled","skinny","sleepy","slight","slim","slimy","slippery","slow","slow","small","small","smart","smiling","smoggy","smooth","smooth","so-called","social","socialist","soft","soft","soft","solar","sole","solid","solid","sophisticated","sore","sorry","sound","sound","sour","southern","soviet","spanish","spare","sparkling","spatial","special","specific","specified","spectacular","spicy","spiritual","splendid","splendid","spontaneous","sporting","spotless","spotty","square","square","squealing","stable","stale","standard","static","statistical","statutory","steady","steady","steep","steep","sticky","sticky","stiff","still","stingy","stormy","straight","straight","straightforward","strange","strange","strange","strategic","strict","striking","striped","strong","strong","structural","stuck","stupid","stupid","subjective","subsequent","substantial","subtle","successful","successful","successive","sudden","sufficient","suitable","sunny","super","super","superb","superior","supporting","supposed","supreme","sure","surprised","surprising","surrounding","surviving","suspicious","sweet","sweet","swift","swiss","symbolic","sympathetic","systematic","tall","tall","tall","tame","tame","tan","tart","tasteless","tasty","technical","technological","teenage","temporary","tender","tender","tender","tense","terrible","terrible","territorial","testy","then","theoretical","thick","thin","thirsty","thorough","thoughtful","thoughtless","thundering","tight","tight","tiny","tiny","tired","tired","top","tory","total","tough","tough","toxic","traditional","tragic","tremendous","tricky","tropical","troubled","turkish","typical","ugliest","ugly","ugly","ugly","ultimate","unable","unacceptable","unaware","uncertain","unchanged","uncomfortable","unconscious","underground","underlying","unemployed","uneven","unexpected","unfair","unfortunate","unhappy","uniform","uninterested","unique","united","universal","unknown","unlikely","unnecessary","unpleasant","unsightly","unusual","unusual","unwilling","upper","upset","upset","uptight","urban","urgent","used","useful","useless","usual","vague","valid","valuable","variable","varied","various","varying","vast","vast","verbal","vertical","very","victorian","victorious","video-taped","violent","visible","visiting","visual","vital","vivacious","vivid","vocational","voiceless","voluntary","vulnerable","wandering","warm","wasteful","watery","weak","weak","wealthy","weary","wee","weekly","weird","welcome","well","well-known","welsh","western","wet","wet","wet","whispering","white","whole","wicked","wicked","wide","wide","wide-eyed","widespread","wild","wild","willing","wise","witty","wonderful","wonderful","wonderful","wooden","wooden","working","working-class","worldwide","worried","worried","worrying","worthwhile","worthy","written","wrong","wrong","yellow","yellow","young","young","yummy","zany","zany","zealous"],N;(function(t){t.assertEqual=r=>r;function e(r){}t.assertIs=e;function s(r){throw new Error}t.assertNever=s,t.arrayToEnum=r=>{let n={};for(let a of r)n[a]=a;return n},t.getValidEnumValues=r=>{let n=t.objectKeys(r).filter(o=>typeof r[r[o]]!="number"),a={};for(let o of n)a[o]=r[o];return t.objectValues(a)},t.objectValues=r=>t.objectKeys(r).map(function(n){return r[n]}),t.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{let n=[];for(let a in r)Object.prototype.hasOwnProperty.call(r,a)&&n.push(a);return n},t.find=(r,n)=>{for(let a of r)if(n(a))return a},t.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function i(r,n=" | "){return r.map(a=>typeof a=="string"?`'${a}'`:a).join(n)}t.joinValues=i,t.jsonStringifyReplacer=(r,n)=>typeof n=="bigint"?n.toString():n})(N||(N={}));var ei;(function(t){t.mergeShapes=(e,s)=>({...e,...s})})(ei||(ei={}));var y=N.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),je=t=>{switch(typeof t){case"undefined":return y.undefined;case"string":return y.string;case"number":return isNaN(t)?y.nan:y.number;case"boolean":return y.boolean;case"function":return y.function;case"bigint":return y.bigint;case"symbol":return y.symbol;case"object":return Array.isArray(t)?y.array:t===null?y.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?y.promise:typeof Map<"u"&&t instanceof Map?y.map:typeof Set<"u"&&t instanceof Set?y.set:typeof Date<"u"&&t instanceof Date?y.date:y.object;default:return y.unknown}},g=N.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),xa=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),se=class extends Error{constructor(e){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};let s=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,s):this.__proto__=s,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let s=e||function(n){return n.message},i={_errors:[]},r=n=>{for(let a of n.issues)if(a.code==="invalid_union")a.unionErrors.map(r);else if(a.code==="invalid_return_type")r(a.returnTypeError);else if(a.code==="invalid_arguments")r(a.argumentsError);else if(a.path.length===0)i._errors.push(s(a));else{let o=i,c=0;for(;c<a.path.length;){let l=a.path[c];c===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(s(a))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return r(this),i}toString(){return this.message}get message(){return JSON.stringify(this.issues,N.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=s=>s.message){let s={},i=[];for(let r of this.issues)r.path.length>0?(s[r.path[0]]=s[r.path[0]]||[],s[r.path[0]].push(e(r))):i.push(e(r));return{formErrors:i,fieldErrors:s}}get formErrors(){return this.flatten()}};se.create=t=>new se(t);var Rt=(t,e)=>{let s;switch(t.code){case g.invalid_type:t.received===y.undefined?s="Required":s=`Expected ${t.expected}, received ${t.received}`;break;case g.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(t.expected,N.jsonStringifyReplacer)}`;break;case g.unrecognized_keys:s=`Unrecognized key(s) in object: ${N.joinValues(t.keys,", ")}`;break;case g.invalid_union:s="Invalid input";break;case g.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${N.joinValues(t.options)}`;break;case g.invalid_enum_value:s=`Invalid enum value. Expected ${N.joinValues(t.options)}, received '${t.received}'`;break;case g.invalid_arguments:s="Invalid function arguments";break;case g.invalid_return_type:s="Invalid function return type";break;case g.invalid_date:s="Invalid date";break;case g.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(s=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(s=`${s} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?s=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?s=`Invalid input: must end with "${t.validation.endsWith}"`:N.assertNever(t.validation):t.validation!=="regex"?s=`Invalid ${t.validation}`:s="Invalid";break;case g.too_small:t.type==="array"?s=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?s=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?s=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?s=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:s="Invalid input";break;case g.too_big:t.type==="array"?s=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?s=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?s=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?s=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?s=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:s="Invalid input";break;case g.custom:s="Invalid input";break;case g.invalid_intersection_types:s="Intersection results could not be merged";break;case g.not_multiple_of:s=`Number must be a multiple of ${t.multipleOf}`;break;case g.not_finite:s="Number must be finite";break;default:s=e.defaultError,N.assertNever(t)}return{message:s}},Cr=Rt;function _a(t){Cr=t}function ps(){return Cr}var fs=t=>{let{data:e,path:s,errorMaps:i,issueData:r}=t,n=[...s,...r.path||[]],a={...r,path:n},o="",c=i.filter(l=>!!l).slice().reverse();for(let l of c)o=l(a,{data:e,defaultError:o}).message;return{...r,path:n,message:r.message||o}},ka=[];function v(t,e){let s=fs({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ps(),Rt].filter(i=>!!i)});t.common.issues.push(s)}var Y=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,s){let i=[];for(let r of s){if(r.status==="aborted")return T;r.status==="dirty"&&e.dirty(),i.push(r.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,s){let i=[];for(let r of s)i.push({key:await r.key,value:await r.value});return t.mergeObjectSync(e,i)}static mergeObjectSync(e,s){let i={};for(let r of s){let{key:n,value:a}=r;if(n.status==="aborted"||a.status==="aborted")return T;n.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(typeof a.value<"u"||r.alwaysSet)&&(i[n.value]=a.value)}return{status:e.value,value:i}}},T=Object.freeze({status:"aborted"}),Mr=t=>({status:"dirty",value:t}),X=t=>({status:"valid",value:t}),ti=t=>t.status==="aborted",si=t=>t.status==="dirty",Lt=t=>t.status==="valid",ms=t=>typeof Promise<"u"&&t instanceof Promise,x;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(x||(x={}));var le=class{constructor(e,s,i,r){this._cachedPath=[],this.parent=e,this.data=s,this._path=i,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},ar=(t,e)=>{if(Lt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let s=new se(t.common.issues);return this._error=s,this._error}}};function M(t){if(!t)return{};let{errorMap:e,invalid_type_error:s,required_error:i,description:r}=t;if(e&&(s||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(n,a)=>n.code!=="invalid_type"?{message:a.defaultError}:typeof a.data>"u"?{message:i??a.defaultError}:{message:s??a.defaultError},description:r}}var P=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return je(e.data)}_getOrReturnCtx(e,s){return s||{common:e.parent.common,data:e.data,parsedType:je(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Y,ctx:{common:e.parent.common,data:e.data,parsedType:je(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let s=this._parse(e);if(ms(s))throw new Error("Synchronous parse encountered promise.");return s}_parseAsync(e){let s=this._parse(e);return Promise.resolve(s)}parse(e,s){let i=this.safeParse(e,s);if(i.success)return i.data;throw i.error}safeParse(e,s){var i;let r={common:{issues:[],async:(i=s?.async)!==null&&i!==void 0?i:!1,contextualErrorMap:s?.errorMap},path:s?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:je(e)},n=this._parseSync({data:e,path:r.path,parent:r});return ar(r,n)}async parseAsync(e,s){let i=await this.safeParseAsync(e,s);if(i.success)return i.data;throw i.error}async safeParseAsync(e,s){let i={common:{issues:[],contextualErrorMap:s?.errorMap,async:!0},path:s?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:je(e)},r=this._parse({data:e,path:i.path,parent:i}),n=await(ms(r)?r:Promise.resolve(r));return ar(i,n)}refine(e,s){let i=r=>typeof s=="string"||typeof s>"u"?{message:s}:typeof s=="function"?s(r):s;return this._refinement((r,n)=>{let a=e(r),o=()=>n.addIssue({code:g.custom,...i(r)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,s){return this._refinement((i,r)=>e(i)?!0:(r.addIssue(typeof s=="function"?s(i,r):s),!1))}_refinement(e){return new ie({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ge.create(this,this._def)}nullable(){return Ie.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ae.create(this,this._def)}promise(){return We.create(this,this._def)}or(e){return it.create([this,e],this._def)}and(e){return rt.create(this,e,this._def)}transform(e){return new ie({...M(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let s=typeof e=="function"?e:()=>e;return new ct({...M(this._def),innerType:this,defaultValue:s,typeName:k.ZodDefault})}brand(){return new ws({typeName:k.ZodBranded,type:this,...M(this._def)})}catch(e){let s=typeof e=="function"?e:()=>e;return new xt({...M(this._def),innerType:this,catchValue:s,typeName:k.ZodCatch})}describe(e){let s=this.constructor;return new s({...this._def,description:e})}pipe(e){return zt.create(this,e)}readonly(){return kt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Sa=/^c[^\s-]{8,}$/i,Oa=/^[a-z][a-z0-9]*$/,Ta=/^[0-9A-HJKMNP-TV-Z]{26}$/,Ca=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ma=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Pa="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Ys,Ea=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,Aa=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Ia=t=>t.precision?t.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${t.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${t.precision}}Z$`):t.precision===0?t.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):t.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function Na(t,e){return!!((e==="v4"||!e)&&Ea.test(t)||(e==="v6"||!e)&&Aa.test(t))}var De=class t extends P{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==y.string){let r=this._getOrReturnCtx(e);return v(r,{code:g.invalid_type,expected:y.string,received:r.parsedType}),T}let s=new Y,i;for(let r of this._def.checks)if(r.kind==="min")e.data.length<r.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:g.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),s.dirty());else if(r.kind==="max")e.data.length>r.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:g.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),s.dirty());else if(r.kind==="length"){let n=e.data.length>r.value,a=e.data.length<r.value;(n||a)&&(i=this._getOrReturnCtx(e,i),n?v(i,{code:g.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):a&&v(i,{code:g.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),s.dirty())}else if(r.kind==="email")Ma.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"email",code:g.invalid_string,message:r.message}),s.dirty());else if(r.kind==="emoji")Ys||(Ys=new RegExp(Pa,"u")),Ys.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"emoji",code:g.invalid_string,message:r.message}),s.dirty());else if(r.kind==="uuid")Ca.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"uuid",code:g.invalid_string,message:r.message}),s.dirty());else if(r.kind==="cuid")Sa.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"cuid",code:g.invalid_string,message:r.message}),s.dirty());else if(r.kind==="cuid2")Oa.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"cuid2",code:g.invalid_string,message:r.message}),s.dirty());else if(r.kind==="ulid")Ta.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"ulid",code:g.invalid_string,message:r.message}),s.dirty());else if(r.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),v(i,{validation:"url",code:g.invalid_string,message:r.message}),s.dirty()}else r.kind==="regex"?(r.regex.lastIndex=0,r.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"regex",code:g.invalid_string,message:r.message}),s.dirty())):r.kind==="trim"?e.data=e.data.trim():r.kind==="includes"?e.data.includes(r.value,r.position)||(i=this._getOrReturnCtx(e,i),v(i,{code:g.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),s.dirty()):r.kind==="toLowerCase"?e.data=e.data.toLowerCase():r.kind==="toUpperCase"?e.data=e.data.toUpperCase():r.kind==="startsWith"?e.data.startsWith(r.value)||(i=this._getOrReturnCtx(e,i),v(i,{code:g.invalid_string,validation:{startsWith:r.value},message:r.message}),s.dirty()):r.kind==="endsWith"?e.data.endsWith(r.value)||(i=this._getOrReturnCtx(e,i),v(i,{code:g.invalid_string,validation:{endsWith:r.value},message:r.message}),s.dirty()):r.kind==="datetime"?Ia(r).test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{code:g.invalid_string,validation:"datetime",message:r.message}),s.dirty()):r.kind==="ip"?Na(e.data,r.version)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"ip",code:g.invalid_string,message:r.message}),s.dirty()):N.assertNever(r);return{status:s.value,value:e.data}}_regex(e,s,i){return this.refinement(r=>e.test(r),{validation:s,code:g.invalid_string,...x.errToObj(i)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...x.errToObj(e)})}url(e){return this._addCheck({kind:"url",...x.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...x.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...x.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...x.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...x.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...x.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...x.errToObj(e)})}datetime(e){var s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(s=e?.offset)!==null&&s!==void 0?s:!1,...x.errToObj(e?.message)})}regex(e,s){return this._addCheck({kind:"regex",regex:e,...x.errToObj(s)})}includes(e,s){return this._addCheck({kind:"includes",value:e,position:s?.position,...x.errToObj(s?.message)})}startsWith(e,s){return this._addCheck({kind:"startsWith",value:e,...x.errToObj(s)})}endsWith(e,s){return this._addCheck({kind:"endsWith",value:e,...x.errToObj(s)})}min(e,s){return this._addCheck({kind:"min",value:e,...x.errToObj(s)})}max(e,s){return this._addCheck({kind:"max",value:e,...x.errToObj(s)})}length(e,s){return this._addCheck({kind:"length",value:e,...x.errToObj(s)})}nonempty(e){return this.min(1,x.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(let s of this._def.checks)s.kind==="min"&&(e===null||s.value>e)&&(e=s.value);return e}get maxLength(){let e=null;for(let s of this._def.checks)s.kind==="max"&&(e===null||s.value<e)&&(e=s.value);return e}};De.create=t=>{var e;return new De({checks:[],typeName:k.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...M(t)})};function Ra(t,e){let s=(t.toString().split(".")[1]||"").length,i=(e.toString().split(".")[1]||"").length,r=s>i?s:i,n=parseInt(t.toFixed(r).replace(".","")),a=parseInt(e.toFixed(r).replace(".",""));return n%a/Math.pow(10,r)}var Je=class t extends P{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==y.number){let r=this._getOrReturnCtx(e);return v(r,{code:g.invalid_type,expected:y.number,received:r.parsedType}),T}let s,i=new Y;for(let r of this._def.checks)r.kind==="int"?N.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:g.invalid_type,expected:"integer",received:"float",message:r.message}),i.dirty()):r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(s=this._getOrReturnCtx(e,s),v(s,{code:g.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(s=this._getOrReturnCtx(e,s),v(s,{code:g.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):r.kind==="multipleOf"?Ra(e.data,r.value)!==0&&(s=this._getOrReturnCtx(e,s),v(s,{code:g.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):r.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:g.not_finite,message:r.message}),i.dirty()):N.assertNever(r);return{status:i.value,value:e.data}}gte(e,s){return this.setLimit("min",e,!0,x.toString(s))}gt(e,s){return this.setLimit("min",e,!1,x.toString(s))}lte(e,s){return this.setLimit("max",e,!0,x.toString(s))}lt(e,s){return this.setLimit("max",e,!1,x.toString(s))}setLimit(e,s,i,r){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:s,inclusive:i,message:x.toString(r)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:x.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:x.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:x.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:x.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:x.toString(e)})}multipleOf(e,s){return this._addCheck({kind:"multipleOf",value:e,message:x.toString(s)})}finite(e){return this._addCheck({kind:"finite",message:x.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:x.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:x.toString(e)})}get minValue(){let e=null;for(let s of this._def.checks)s.kind==="min"&&(e===null||s.value>e)&&(e=s.value);return e}get maxValue(){let e=null;for(let s of this._def.checks)s.kind==="max"&&(e===null||s.value<e)&&(e=s.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&N.isInteger(e.value))}get isFinite(){let e=null,s=null;for(let i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(s===null||i.value>s)&&(s=i.value):i.kind==="max"&&(e===null||i.value<e)&&(e=i.value)}return Number.isFinite(s)&&Number.isFinite(e)}};Je.create=t=>new Je({checks:[],typeName:k.ZodNumber,coerce:t?.coerce||!1,...M(t)});var He=class t extends P{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==y.bigint){let r=this._getOrReturnCtx(e);return v(r,{code:g.invalid_type,expected:y.bigint,received:r.parsedType}),T}let s,i=new Y;for(let r of this._def.checks)r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(s=this._getOrReturnCtx(e,s),v(s,{code:g.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(s=this._getOrReturnCtx(e,s),v(s,{code:g.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):r.kind==="multipleOf"?e.data%r.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),v(s,{code:g.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):N.assertNever(r);return{status:i.value,value:e.data}}gte(e,s){return this.setLimit("min",e,!0,x.toString(s))}gt(e,s){return this.setLimit("min",e,!1,x.toString(s))}lte(e,s){return this.setLimit("max",e,!0,x.toString(s))}lt(e,s){return this.setLimit("max",e,!1,x.toString(s))}setLimit(e,s,i,r){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:s,inclusive:i,message:x.toString(r)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:x.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:x.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:x.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:x.toString(e)})}multipleOf(e,s){return this._addCheck({kind:"multipleOf",value:e,message:x.toString(s)})}get minValue(){let e=null;for(let s of this._def.checks)s.kind==="min"&&(e===null||s.value>e)&&(e=s.value);return e}get maxValue(){let e=null;for(let s of this._def.checks)s.kind==="max"&&(e===null||s.value<e)&&(e=s.value);return e}};He.create=t=>{var e;return new He({checks:[],typeName:k.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...M(t)})};var Qe=class extends P{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==y.boolean){let s=this._getOrReturnCtx(e);return v(s,{code:g.invalid_type,expected:y.boolean,received:s.parsedType}),T}return X(e.data)}};Qe.create=t=>new Qe({typeName:k.ZodBoolean,coerce:t?.coerce||!1,...M(t)});var et=class t extends P{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==y.date){let r=this._getOrReturnCtx(e);return v(r,{code:g.invalid_type,expected:y.date,received:r.parsedType}),T}if(isNaN(e.data.getTime())){let r=this._getOrReturnCtx(e);return v(r,{code:g.invalid_date}),T}let s=new Y,i;for(let r of this._def.checks)r.kind==="min"?e.data.getTime()<r.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:g.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),s.dirty()):r.kind==="max"?e.data.getTime()>r.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:g.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),s.dirty()):N.assertNever(r);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,s){return this._addCheck({kind:"min",value:e.getTime(),message:x.toString(s)})}max(e,s){return this._addCheck({kind:"max",value:e.getTime(),message:x.toString(s)})}get minDate(){let e=null;for(let s of this._def.checks)s.kind==="min"&&(e===null||s.value>e)&&(e=s.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let s of this._def.checks)s.kind==="max"&&(e===null||s.value<e)&&(e=s.value);return e!=null?new Date(e):null}};et.create=t=>new et({checks:[],coerce:t?.coerce||!1,typeName:k.ZodDate,...M(t)});var yt=class extends P{_parse(e){if(this._getType(e)!==y.symbol){let s=this._getOrReturnCtx(e);return v(s,{code:g.invalid_type,expected:y.symbol,received:s.parsedType}),T}return X(e.data)}};yt.create=t=>new yt({typeName:k.ZodSymbol,...M(t)});var tt=class extends P{_parse(e){if(this._getType(e)!==y.undefined){let s=this._getOrReturnCtx(e);return v(s,{code:g.invalid_type,expected:y.undefined,received:s.parsedType}),T}return X(e.data)}};tt.create=t=>new tt({typeName:k.ZodUndefined,...M(t)});var st=class extends P{_parse(e){if(this._getType(e)!==y.null){let s=this._getOrReturnCtx(e);return v(s,{code:g.invalid_type,expected:y.null,received:s.parsedType}),T}return X(e.data)}};st.create=t=>new st({typeName:k.ZodNull,...M(t)});var Be=class extends P{constructor(){super(...arguments),this._any=!0}_parse(e){return X(e.data)}};Be.create=t=>new Be({typeName:k.ZodAny,...M(t)});var Me=class extends P{constructor(){super(...arguments),this._unknown=!0}_parse(e){return X(e.data)}};Me.create=t=>new Me({typeName:k.ZodUnknown,...M(t)});var ye=class extends P{_parse(e){let s=this._getOrReturnCtx(e);return v(s,{code:g.invalid_type,expected:y.never,received:s.parsedType}),T}};ye.create=t=>new ye({typeName:k.ZodNever,...M(t)});var vt=class extends P{_parse(e){if(this._getType(e)!==y.undefined){let s=this._getOrReturnCtx(e);return v(s,{code:g.invalid_type,expected:y.void,received:s.parsedType}),T}return X(e.data)}};vt.create=t=>new vt({typeName:k.ZodVoid,...M(t)});var Ae=class t extends P{_parse(e){let{ctx:s,status:i}=this._processInputParams(e),r=this._def;if(s.parsedType!==y.array)return v(s,{code:g.invalid_type,expected:y.array,received:s.parsedType}),T;if(r.exactLength!==null){let a=s.data.length>r.exactLength.value,o=s.data.length<r.exactLength.value;(a||o)&&(v(s,{code:a?g.too_big:g.too_small,minimum:o?r.exactLength.value:void 0,maximum:a?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),i.dirty())}if(r.minLength!==null&&s.data.length<r.minLength.value&&(v(s,{code:g.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),i.dirty()),r.maxLength!==null&&s.data.length>r.maxLength.value&&(v(s,{code:g.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),i.dirty()),s.common.async)return Promise.all([...s.data].map((a,o)=>r.type._parseAsync(new le(s,a,s.path,o)))).then(a=>Y.mergeArray(i,a));let n=[...s.data].map((a,o)=>r.type._parseSync(new le(s,a,s.path,o)));return Y.mergeArray(i,n)}get element(){return this._def.type}min(e,s){return new t({...this._def,minLength:{value:e,message:x.toString(s)}})}max(e,s){return new t({...this._def,maxLength:{value:e,message:x.toString(s)}})}length(e,s){return new t({...this._def,exactLength:{value:e,message:x.toString(s)}})}nonempty(e){return this.min(1,e)}};Ae.create=(t,e)=>new Ae({type:t,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...M(e)});function ft(t){if(t instanceof H){let e={};for(let s in t.shape){let i=t.shape[s];e[s]=ge.create(ft(i))}return new H({...t._def,shape:()=>e})}else return t instanceof Ae?new Ae({...t._def,type:ft(t.element)}):t instanceof ge?ge.create(ft(t.unwrap())):t instanceof Ie?Ie.create(ft(t.unwrap())):t instanceof be?be.create(t.items.map(e=>ft(e))):t}var H=class t extends P{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),s=N.objectKeys(e);return this._cached={shape:e,keys:s}}_parse(e){if(this._getType(e)!==y.object){let c=this._getOrReturnCtx(e);return v(c,{code:g.invalid_type,expected:y.object,received:c.parsedType}),T}let{status:s,ctx:i}=this._processInputParams(e),{shape:r,keys:n}=this._getCached(),a=[];if(!(this._def.catchall instanceof ye&&this._def.unknownKeys==="strip"))for(let c in i.data)n.includes(c)||a.push(c);let o=[];for(let c of n){let l=r[c],d=i.data[c];o.push({key:{status:"valid",value:c},value:l._parse(new le(i,d,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof ye){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of a)o.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(c==="strict")a.length>0&&(v(i,{code:g.unrecognized_keys,keys:a}),s.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of a){let d=i.data[l];o.push({key:{status:"valid",value:l},value:c._parse(new le(i,d,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of o){let d=await l.key;c.push({key:d,value:await l.value,alwaysSet:l.alwaysSet})}return c}).then(c=>Y.mergeObjectSync(s,c)):Y.mergeObjectSync(s,o)}get shape(){return this._def.shape()}strict(e){return x.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(s,i)=>{var r,n,a,o;let c=(a=(n=(r=this._def).errorMap)===null||n===void 0?void 0:n.call(r,s,i).message)!==null&&a!==void 0?a:i.defaultError;return s.code==="unrecognized_keys"?{message:(o=x.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:k.ZodObject})}setKey(e,s){return this.augment({[e]:s})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let s={};return N.objectKeys(e).forEach(i=>{e[i]&&this.shape[i]&&(s[i]=this.shape[i])}),new t({...this._def,shape:()=>s})}omit(e){let s={};return N.objectKeys(this.shape).forEach(i=>{e[i]||(s[i]=this.shape[i])}),new t({...this._def,shape:()=>s})}deepPartial(){return ft(this)}partial(e){let s={};return N.objectKeys(this.shape).forEach(i=>{let r=this.shape[i];e&&!e[i]?s[i]=r:s[i]=r.optional()}),new t({...this._def,shape:()=>s})}required(e){let s={};return N.objectKeys(this.shape).forEach(i=>{if(e&&!e[i])s[i]=this.shape[i];else{let r=this.shape[i];for(;r instanceof ge;)r=r._def.innerType;s[i]=r}}),new t({...this._def,shape:()=>s})}keyof(){return Pr(N.objectKeys(this.shape))}};H.create=(t,e)=>new H({shape:()=>t,unknownKeys:"strip",catchall:ye.create(),typeName:k.ZodObject,...M(e)});H.strictCreate=(t,e)=>new H({shape:()=>t,unknownKeys:"strict",catchall:ye.create(),typeName:k.ZodObject,...M(e)});H.lazycreate=(t,e)=>new H({shape:t,unknownKeys:"strip",catchall:ye.create(),typeName:k.ZodObject,...M(e)});var it=class extends P{_parse(e){let{ctx:s}=this._processInputParams(e),i=this._def.options;function r(n){for(let o of n)if(o.result.status==="valid")return o.result;for(let o of n)if(o.result.status==="dirty")return s.common.issues.push(...o.ctx.common.issues),o.result;let a=n.map(o=>new se(o.ctx.common.issues));return v(s,{code:g.invalid_union,unionErrors:a}),T}if(s.common.async)return Promise.all(i.map(async n=>{let a={...s,common:{...s.common,issues:[]},parent:null};return{result:await n._parseAsync({data:s.data,path:s.path,parent:a}),ctx:a}})).then(r);{let n,a=[];for(let c of i){let l={...s,common:{...s.common,issues:[]},parent:null},d=c._parseSync({data:s.data,path:s.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!n&&(n={result:d,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(n)return s.common.issues.push(...n.ctx.common.issues),n.result;let o=a.map(c=>new se(c));return v(s,{code:g.invalid_union,unionErrors:o}),T}}get options(){return this._def.options}};it.create=(t,e)=>new it({options:t,typeName:k.ZodUnion,...M(e)});var es=t=>t instanceof nt?es(t.schema):t instanceof ie?es(t.innerType()):t instanceof at?[t.value]:t instanceof ot?t.options:t instanceof lt?Object.keys(t.enum):t instanceof ct?es(t._def.innerType):t instanceof tt?[void 0]:t instanceof st?[null]:null,gs=class t extends P{_parse(e){let{ctx:s}=this._processInputParams(e);if(s.parsedType!==y.object)return v(s,{code:g.invalid_type,expected:y.object,received:s.parsedType}),T;let i=this.discriminator,r=s.data[i],n=this.optionsMap.get(r);return n?s.common.async?n._parseAsync({data:s.data,path:s.path,parent:s}):n._parseSync({data:s.data,path:s.path,parent:s}):(v(s,{code:g.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),T)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,s,i){let r=new Map;for(let n of s){let a=es(n.shape[e]);if(!a)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(r.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);r.set(o,n)}}return new t({typeName:k.ZodDiscriminatedUnion,discriminator:e,options:s,optionsMap:r,...M(i)})}};function ii(t,e){let s=je(t),i=je(e);if(t===e)return{valid:!0,data:t};if(s===y.object&&i===y.object){let r=N.objectKeys(e),n=N.objectKeys(t).filter(o=>r.indexOf(o)!==-1),a={...t,...e};for(let o of n){let c=ii(t[o],e[o]);if(!c.valid)return{valid:!1};a[o]=c.data}return{valid:!0,data:a}}else if(s===y.array&&i===y.array){if(t.length!==e.length)return{valid:!1};let r=[];for(let n=0;n<t.length;n++){let a=t[n],o=e[n],c=ii(a,o);if(!c.valid)return{valid:!1};r.push(c.data)}return{valid:!0,data:r}}else return s===y.date&&i===y.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var rt=class extends P{_parse(e){let{status:s,ctx:i}=this._processInputParams(e),r=(n,a)=>{if(ti(n)||ti(a))return T;let o=ii(n.value,a.value);return o.valid?((si(n)||si(a))&&s.dirty(),{status:s.value,value:o.data}):(v(i,{code:g.invalid_intersection_types}),T)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([n,a])=>r(n,a)):r(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}};rt.create=(t,e,s)=>new rt({left:t,right:e,typeName:k.ZodIntersection,...M(s)});var be=class t extends P{_parse(e){let{status:s,ctx:i}=this._processInputParams(e);if(i.parsedType!==y.array)return v(i,{code:g.invalid_type,expected:y.array,received:i.parsedType}),T;if(i.data.length<this._def.items.length)return v(i,{code:g.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),T;!this._def.rest&&i.data.length>this._def.items.length&&(v(i,{code:g.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),s.dirty());let r=[...i.data].map((n,a)=>{let o=this._def.items[a]||this._def.rest;return o?o._parse(new le(i,n,i.path,a)):null}).filter(n=>!!n);return i.common.async?Promise.all(r).then(n=>Y.mergeArray(s,n)):Y.mergeArray(s,r)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};be.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new be({items:t,typeName:k.ZodTuple,rest:null,...M(e)})};var ys=class t extends P{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:s,ctx:i}=this._processInputParams(e);if(i.parsedType!==y.object)return v(i,{code:g.invalid_type,expected:y.object,received:i.parsedType}),T;let r=[],n=this._def.keyType,a=this._def.valueType;for(let o in i.data)r.push({key:n._parse(new le(i,o,i.path,o)),value:a._parse(new le(i,i.data[o],i.path,o))});return i.common.async?Y.mergeObjectAsync(s,r):Y.mergeObjectSync(s,r)}get element(){return this._def.valueType}static create(e,s,i){return s instanceof P?new t({keyType:e,valueType:s,typeName:k.ZodRecord,...M(i)}):new t({keyType:De.create(),valueType:e,typeName:k.ZodRecord,...M(s)})}},wt=class extends P{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:s,ctx:i}=this._processInputParams(e);if(i.parsedType!==y.map)return v(i,{code:g.invalid_type,expected:y.map,received:i.parsedType}),T;let r=this._def.keyType,n=this._def.valueType,a=[...i.data.entries()].map(([o,c],l)=>({key:r._parse(new le(i,o,i.path,[l,"key"])),value:n._parse(new le(i,c,i.path,[l,"value"]))}));if(i.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let c of a){let l=await c.key,d=await c.value;if(l.status==="aborted"||d.status==="aborted")return T;(l.status==="dirty"||d.status==="dirty")&&s.dirty(),o.set(l.value,d.value)}return{status:s.value,value:o}})}else{let o=new Map;for(let c of a){let l=c.key,d=c.value;if(l.status==="aborted"||d.status==="aborted")return T;(l.status==="dirty"||d.status==="dirty")&&s.dirty(),o.set(l.value,d.value)}return{status:s.value,value:o}}}};wt.create=(t,e,s)=>new wt({valueType:e,keyType:t,typeName:k.ZodMap,...M(s)});var bt=class t extends P{_parse(e){let{status:s,ctx:i}=this._processInputParams(e);if(i.parsedType!==y.set)return v(i,{code:g.invalid_type,expected:y.set,received:i.parsedType}),T;let r=this._def;r.minSize!==null&&i.data.size<r.minSize.value&&(v(i,{code:g.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),s.dirty()),r.maxSize!==null&&i.data.size>r.maxSize.value&&(v(i,{code:g.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),s.dirty());let n=this._def.valueType;function a(c){let l=new Set;for(let d of c){if(d.status==="aborted")return T;d.status==="dirty"&&s.dirty(),l.add(d.value)}return{status:s.value,value:l}}let o=[...i.data.values()].map((c,l)=>n._parse(new le(i,c,i.path,l)));return i.common.async?Promise.all(o).then(c=>a(c)):a(o)}min(e,s){return new t({...this._def,minSize:{value:e,message:x.toString(s)}})}max(e,s){return new t({...this._def,maxSize:{value:e,message:x.toString(s)}})}size(e,s){return this.min(e,s).max(e,s)}nonempty(e){return this.min(1,e)}};bt.create=(t,e)=>new bt({valueType:t,minSize:null,maxSize:null,typeName:k.ZodSet,...M(e)});var vs=class t extends P{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:s}=this._processInputParams(e);if(s.parsedType!==y.function)return v(s,{code:g.invalid_type,expected:y.function,received:s.parsedType}),T;function i(o,c){return fs({data:o,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,ps(),Rt].filter(l=>!!l),issueData:{code:g.invalid_arguments,argumentsError:c}})}function r(o,c){return fs({data:o,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,ps(),Rt].filter(l=>!!l),issueData:{code:g.invalid_return_type,returnTypeError:c}})}let n={errorMap:s.common.contextualErrorMap},a=s.data;if(this._def.returns instanceof We){let o=this;return X(async function(...c){let l=new se([]),d=await o._def.args.parseAsync(c,n).catch(m=>{throw l.addIssue(i(c,m)),l}),u=await Reflect.apply(a,this,d);return await o._def.returns._def.type.parseAsync(u,n).catch(m=>{throw l.addIssue(r(u,m)),l})})}else{let o=this;return X(function(...c){let l=o._def.args.safeParse(c,n);if(!l.success)throw new se([i(c,l.error)]);let d=Reflect.apply(a,this,l.data),u=o._def.returns.safeParse(d,n);if(!u.success)throw new se([r(d,u.error)]);return u.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:be.create(e).rest(Me.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,s,i){return new t({args:e||be.create([]).rest(Me.create()),returns:s||Me.create(),typeName:k.ZodFunction,...M(i)})}},nt=class extends P{get schema(){return this._def.getter()}_parse(e){let{ctx:s}=this._processInputParams(e);return this._def.getter()._parse({data:s.data,path:s.path,parent:s})}};nt.create=(t,e)=>new nt({getter:t,typeName:k.ZodLazy,...M(e)});var at=class extends P{_parse(e){if(e.data!==this._def.value){let s=this._getOrReturnCtx(e);return v(s,{received:s.data,code:g.invalid_literal,expected:this._def.value}),T}return{status:"valid",value:e.data}}get value(){return this._def.value}};at.create=(t,e)=>new at({value:t,typeName:k.ZodLiteral,...M(e)});function Pr(t,e){return new ot({values:t,typeName:k.ZodEnum,...M(e)})}var ot=class t extends P{_parse(e){if(typeof e.data!="string"){let s=this._getOrReturnCtx(e),i=this._def.values;return v(s,{expected:N.joinValues(i),received:s.parsedType,code:g.invalid_type}),T}if(this._def.values.indexOf(e.data)===-1){let s=this._getOrReturnCtx(e),i=this._def.values;return v(s,{received:s.data,code:g.invalid_enum_value,options:i}),T}return X(e.data)}get options(){return this._def.values}get enum(){let e={};for(let s of this._def.values)e[s]=s;return e}get Values(){let e={};for(let s of this._def.values)e[s]=s;return e}get Enum(){let e={};for(let s of this._def.values)e[s]=s;return e}extract(e){return t.create(e)}exclude(e){return t.create(this.options.filter(s=>!e.includes(s)))}};ot.create=Pr;var lt=class extends P{_parse(e){let s=N.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==y.string&&i.parsedType!==y.number){let r=N.objectValues(s);return v(i,{expected:N.joinValues(r),received:i.parsedType,code:g.invalid_type}),T}if(s.indexOf(e.data)===-1){let r=N.objectValues(s);return v(i,{received:i.data,code:g.invalid_enum_value,options:r}),T}return X(e.data)}get enum(){return this._def.values}};lt.create=(t,e)=>new lt({values:t,typeName:k.ZodNativeEnum,...M(e)});var We=class extends P{unwrap(){return this._def.type}_parse(e){let{ctx:s}=this._processInputParams(e);if(s.parsedType!==y.promise&&s.common.async===!1)return v(s,{code:g.invalid_type,expected:y.promise,received:s.parsedType}),T;let i=s.parsedType===y.promise?s.data:Promise.resolve(s.data);return X(i.then(r=>this._def.type.parseAsync(r,{path:s.path,errorMap:s.common.contextualErrorMap})))}};We.create=(t,e)=>new We({type:t,typeName:k.ZodPromise,...M(e)});var ie=class extends P{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:s,ctx:i}=this._processInputParams(e),r=this._def.effect||null,n={addIssue:a=>{v(i,a),a.fatal?s.abort():s.dirty()},get path(){return i.path}};if(n.addIssue=n.addIssue.bind(n),r.type==="preprocess"){let a=r.transform(i.data,n);return i.common.issues.length?{status:"dirty",value:i.data}:i.common.async?Promise.resolve(a).then(o=>this._def.schema._parseAsync({data:o,path:i.path,parent:i})):this._def.schema._parseSync({data:a,path:i.path,parent:i})}if(r.type==="refinement"){let a=o=>{let c=r.refinement(o,n);if(i.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(i.common.async===!1){let o=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return o.status==="aborted"?T:(o.status==="dirty"&&s.dirty(),a(o.value),{status:s.value,value:o.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(o=>o.status==="aborted"?T:(o.status==="dirty"&&s.dirty(),a(o.value).then(()=>({status:s.value,value:o.value}))))}if(r.type==="transform")if(i.common.async===!1){let a=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!Lt(a))return a;let o=r.transform(a.value,n);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:s.value,value:o}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(a=>Lt(a)?Promise.resolve(r.transform(a.value,n)).then(o=>({status:s.value,value:o})):a);N.assertNever(r)}};ie.create=(t,e,s)=>new ie({schema:t,typeName:k.ZodEffects,effect:e,...M(s)});ie.createWithPreprocess=(t,e,s)=>new ie({schema:e,effect:{type:"preprocess",transform:t},typeName:k.ZodEffects,...M(s)});var ge=class extends P{_parse(e){return this._getType(e)===y.undefined?X(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ge.create=(t,e)=>new ge({innerType:t,typeName:k.ZodOptional,...M(e)});var Ie=class extends P{_parse(e){return this._getType(e)===y.null?X(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ie.create=(t,e)=>new Ie({innerType:t,typeName:k.ZodNullable,...M(e)});var ct=class extends P{_parse(e){let{ctx:s}=this._processInputParams(e),i=s.data;return s.parsedType===y.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:s.path,parent:s})}removeDefault(){return this._def.innerType}};ct.create=(t,e)=>new ct({innerType:t,typeName:k.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...M(e)});var xt=class extends P{_parse(e){let{ctx:s}=this._processInputParams(e),i={...s,common:{...s.common,issues:[]}},r=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return ms(r)?r.then(n=>({status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new se(i.common.issues)},input:i.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new se(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}};xt.create=(t,e)=>new xt({innerType:t,typeName:k.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...M(e)});var _t=class extends P{_parse(e){if(this._getType(e)!==y.nan){let s=this._getOrReturnCtx(e);return v(s,{code:g.invalid_type,expected:y.nan,received:s.parsedType}),T}return{status:"valid",value:e.data}}};_t.create=t=>new _t({typeName:k.ZodNaN,...M(t)});var La=Symbol("zod_brand"),ws=class extends P{_parse(e){let{ctx:s}=this._processInputParams(e),i=s.data;return this._def.type._parse({data:i,path:s.path,parent:s})}unwrap(){return this._def.type}},zt=class t extends P{_parse(e){let{status:s,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{let r=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?T:r.status==="dirty"?(s.dirty(),Mr(r.value)):this._def.out._parseAsync({data:r.value,path:i.path,parent:i})})();{let r=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?T:r.status==="dirty"?(s.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:i.path,parent:i})}}static create(e,s){return new t({in:e,out:s,typeName:k.ZodPipeline})}},kt=class extends P{_parse(e){let s=this._def.innerType._parse(e);return Lt(s)&&(s.value=Object.freeze(s.value)),s}};kt.create=(t,e)=>new kt({innerType:t,typeName:k.ZodReadonly,...M(e)});var Er=(t,e={},s)=>t?Be.create().superRefine((i,r)=>{var n,a;if(!t(i)){let o=typeof e=="function"?e(i):typeof e=="string"?{message:e}:e,c=(a=(n=o.fatal)!==null&&n!==void 0?n:s)!==null&&a!==void 0?a:!0,l=typeof o=="string"?{message:o}:o;r.addIssue({code:"custom",...l,fatal:c})}}):Be.create(),za={object:H.lazycreate},k;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(k||(k={}));var Ua=(t,e={message:`Input not instance of ${t.name}`})=>Er(s=>s instanceof t,e),Ar=De.create,Ir=Je.create,Za=_t.create,Fa=He.create,Nr=Qe.create,ja=et.create,$a=yt.create,Da=tt.create,Ba=st.create,Wa=Be.create,Va=Me.create,qa=ye.create,Ga=vt.create,Ya=Ae.create,Ka=H.create,Xa=H.strictCreate,Ja=it.create,Ha=gs.create,Qa=rt.create,eo=be.create,to=ys.create,so=wt.create,io=bt.create,ro=vs.create,no=nt.create,ao=at.create,oo=ot.create,lo=lt.create,co=We.create,or=ie.create,uo=ge.create,ho=Ie.create,po=ie.createWithPreprocess,fo=zt.create,mo=()=>Ar().optional(),go=()=>Ir().optional(),yo=()=>Nr().optional(),vo={string:t=>De.create({...t,coerce:!0}),number:t=>Je.create({...t,coerce:!0}),boolean:t=>Qe.create({...t,coerce:!0}),bigint:t=>He.create({...t,coerce:!0}),date:t=>et.create({...t,coerce:!0})},wo=T,w=Object.freeze({__proto__:null,defaultErrorMap:Rt,setErrorMap:_a,getErrorMap:ps,makeIssue:fs,EMPTY_PATH:ka,addIssueToContext:v,ParseStatus:Y,INVALID:T,DIRTY:Mr,OK:X,isAborted:ti,isDirty:si,isValid:Lt,isAsync:ms,get util(){return N},get objectUtil(){return ei},ZodParsedType:y,getParsedType:je,ZodType:P,ZodString:De,ZodNumber:Je,ZodBigInt:He,ZodBoolean:Qe,ZodDate:et,ZodSymbol:yt,ZodUndefined:tt,ZodNull:st,ZodAny:Be,ZodUnknown:Me,ZodNever:ye,ZodVoid:vt,ZodArray:Ae,ZodObject:H,ZodUnion:it,ZodDiscriminatedUnion:gs,ZodIntersection:rt,ZodTuple:be,ZodRecord:ys,ZodMap:wt,ZodSet:bt,ZodFunction:vs,ZodLazy:nt,ZodLiteral:at,ZodEnum:ot,ZodNativeEnum:lt,ZodPromise:We,ZodEffects:ie,ZodTransformer:ie,ZodOptional:ge,ZodNullable:Ie,ZodDefault:ct,ZodCatch:xt,ZodNaN:_t,BRAND:La,ZodBranded:ws,ZodPipeline:zt,ZodReadonly:kt,custom:Er,Schema:P,ZodSchema:P,late:za,get ZodFirstPartyTypeKind(){return k},coerce:vo,any:Wa,array:Ya,bigint:Fa,boolean:Nr,date:ja,discriminatedUnion:Ha,effect:or,enum:oo,function:ro,instanceof:Ua,intersection:Qa,lazy:no,literal:ao,map:so,nan:Za,nativeEnum:lo,never:qa,null:Ba,nullable:ho,number:Ir,object:Ka,oboolean:yo,onumber:go,optional:uo,ostring:mo,pipeline:fo,preprocess:po,promise:co,record:to,set:io,strictObject:Xa,string:Ar,symbol:$a,transformer:or,tuple:eo,undefined:Da,union:Ja,unknown:Va,void:Ga,NEVER:wo,ZodIssueCode:g,quotelessJson:xa,ZodError:se}),Ze,Ce,ts,At,ss,is,Ks,rs,ri,ni,Rr,It,bs,Fe=class Z{constructor(e,s){G(this,At),G(this,is),G(this,rs),G(this,ni),G(this,It),G(this,Ze,void 0),G(this,Ce,void 0),G(this,ts,void 0),this.reset(e,s)}reset(e,s){typeof e=="string"?K(this,Ze,oe(this,ni,Rr).call(this,e)):typeof e=="number"?K(this,Ze,oe(this,It,bs).call(this,e)):K(this,Ze,O(this,Ze)??oe(this,It,bs).call(this,Z.MIN+Math.floor((Z.MAX-Z.MIN)*Math.random()))),K(this,Ce,s??O(this,Ze)),K(this,ts,bo(this))}toJSON(){return{__serializedName:Z.serializedName,seed:O(this,Ze),value:O(this,Ce)}}static fromJSON(e){return new Z(e.seed,e.value)}number(e=0,s=1){return oe(this,At,ss).call(this),oe(this,rs,ri).call(this,O(this,Ce),Z.MIN,Z.MAX,e,s)}int(e=10,s=100){return oe(this,At,ss).call(this),Math.floor(oe(this,rs,ri).call(this,O(this,Ce),Z.MIN,Z.MAX,e,s+1))}bool(){return oe(this,At,ss).call(this),O(this,Ce)>.5}identifier(e=21){return O(this,ts).call(this,e)}coinFlip(){return this.bool()}diceRoll(e=6){return this.int(0,e-1)}yahtzee(e=5){let s=-1;for(let i=0;i<e;i++){let r=this.diceRoll();if(s!=-1&&s!=r)return!1;s=r}return!0}pickOne(e){return e[this.int(0,e.length-1)]}shuffle(e){for(let s=e.length-1;s>0;s--){let i=this.int(0,s),r=e[i];e[i]=e[s],e[s]=r}return e}animal(){return this.pickOne(ba)+"_"+this.pickOne(wa)}static serialize(){return JSON.stringify(Z.singleton)}static deserialize(e){Z.singleton=Z.fromJSON(w.object({seed:w.number(),value:w.number()}).parse(JSON.parse(e)))}static setSeed(e,s){Z.singleton.reset(e,s)}static number(e=0,s=1){return Z.singleton.number(e,s)}static int(e=10,s=100){return Z.singleton.int(e,s)}static bool(){return Z.singleton.bool()}static identifier(e){return Z.singleton.identifier(e)}static coinFlip(){return Z.singleton.coinFlip()}static diceRoll(e=6){return Z.singleton.diceRoll(e)}static yahtzee(e=5){return Z.singleton.yahtzee(e)}static pickOne(e){return Z.singleton.pickOne(e)}static shuffle(e){return Z.singleton.shuffle(e)}static animal(){return Z.singleton.animal()}};Ze=new WeakMap,Ce=new WeakMap,ts=new WeakMap,At=new WeakSet,ss=function(){K(this,Ce,oe(this,is,Ks).call(this,O(this,Ce)))},is=new WeakSet,Ks=function(t){return t^=t<<13,t^=t>>17,t^=t<<5,t},rs=new WeakSet,ri=function(t,e,s,i,r){return(t-e)/(s-e)*(r-i)+i},ni=new WeakSet,Rr=function(t){let e=0;if(t){let s=t.length;for(let i=0;i<s;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0,e=oe(this,is,Ks).call(this,e)}return oe(this,It,bs).call(this,e)},It=new WeakSet,bs=function(t){return t===0?1:t},p(Fe,"serializedName","Random"),p(Fe,"MIN",-2147483648),p(Fe,"MAX",2147483647),p(Fe,"sdk",new Fe),p(Fe,"singleton",new Fe);var Ts=Fe;function bo(t){return En(Pn,21,e=>new Uint8Array(e).map(()=>256*t.number()))}(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var Lr=class extends Event{constructor(t,e){super("error",e),p(this,"message"),p(this,"error"),this.message=t.message,this.error=t}},zr=class extends Event{constructor(t=1e3,e="",s){super("close",s),p(this,"code"),p(this,"reason"),p(this,"wasClean",!0),this.code=t,this.reason=e}},Xs={Event,ErrorEvent:Lr,CloseEvent:zr};function xo(t,e){if(!t)throw new Error(e)}function _o(t){return new t.constructor(t.type,t)}function ko(t){return"data"in t?new MessageEvent(t.type,t):"code"in t||"reason"in t?new zr(t.code||1999,t.reason||"unknown reason",t):"error"in t?new Lr(t.error,t):new Event(t.type,t)}var lr,So=typeof process<"u"&&typeof((lr=process.versions)==null?void 0:lr.node)<"u"&&typeof document>"u",Xt=So?ko:_o,qe={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},cr=!1,Ur=class Ye extends EventTarget{constructor(e,s,i={}){super(),p(this,"_ws"),p(this,"_retryCount",-1),p(this,"_uptimeTimeout"),p(this,"_connectTimeout"),p(this,"_shouldReconnect",!0),p(this,"_connectLock",!1),p(this,"_binaryType","blob"),p(this,"_closeCalled",!1),p(this,"_messageQueue",[]),p(this,"_debugLogger",console.log.bind(console)),p(this,"_url"),p(this,"_protocols"),p(this,"_options"),p(this,"onclose",null),p(this,"onerror",null),p(this,"onmessage",null),p(this,"onopen",null),p(this,"_handleOpen",r=>{this._debug("open event");let{minUptime:n=qe.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),n),xo(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(a=>{var o;return(o=this._ws)==null?void 0:o.send(a)}),this._messageQueue=[],this.onopen&&this.onopen(r),this.dispatchEvent(Xt(r))}),p(this,"_handleMessage",r=>{this._debug("message event"),this.onmessage&&this.onmessage(r),this.dispatchEvent(Xt(r))}),p(this,"_handleError",r=>{this._debug("error event",r.message),this._disconnect(void 0,r.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(r),this._debug("exec error listeners"),this.dispatchEvent(Xt(r)),this._connect()}),p(this,"_handleClose",r=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(r),this.dispatchEvent(Xt(r))}),this._url=e,this._protocols=s,this._options=i,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return Ye.CONNECTING}get OPEN(){return Ye.OPEN}get CLOSING(){return Ye.CLOSING}get CLOSED(){return Ye.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((e,s)=>(typeof s=="string"?e+=s.length:s instanceof Blob?e+=s.size:e+=s.byteLength,e),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?Ye.CLOSED:Ye.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}close(e=1e3,s){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,s)}reconnect(e,s){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,s),this._connect())}send(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{let{maxEnqueuedMessages:s=qe.maxEnqueuedMessages}=this._options;this._messageQueue.length<s&&(this._debug("enqueue",e),this._messageQueue.push(e))}}_debug(...e){this._options.debug&&this._debugLogger("RWS>",...e)}_getNextDelay(){let{reconnectionDelayGrowFactor:e=qe.reconnectionDelayGrowFactor,minReconnectionDelay:s=qe.minReconnectionDelay,maxReconnectionDelay:i=qe.maxReconnectionDelay}=this._options,r=0;return this._retryCount>0&&(r=s*Math.pow(e,this._retryCount-1),r>i&&(r=i)),this._debug("next delay",r),r}_wait(){return new Promise(e=>{setTimeout(e,this._getNextDelay())})}_getNextProtocols(e){if(!e)return Promise.resolve(null);if(typeof e=="string"||Array.isArray(e))return Promise.resolve(e);if(typeof e=="function"){let s=e();if(!s)return Promise.resolve(null);if(typeof s=="string"||Array.isArray(s))return Promise.resolve(s);if(s.then)return s}throw Error("Invalid protocols")}_getNextUrl(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){let s=e();if(typeof s=="string")return Promise.resolve(s);if(s.then)return s}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;let{maxRetries:e=qe.maxRetries,connectionTimeout:s=qe.connectionTimeout}=this._options;if(this._retryCount>=e){this._debug("max retries reached",this._retryCount,">=",e);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([i,r])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!cr&&(console.error(`\u203C\uFE0F No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),cr=!0);let n=this._options.WebSocket||WebSocket;this._debug("connect",{url:i,protocols:r}),this._ws=r?new n(i,r):new n(i),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),s)}).catch(i=>{this._connectLock=!1,this._handleError(new Xs.ErrorEvent(Error(i.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new Xs.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(e=1e3,s){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,s),this._handleClose(new Xs.CloseEvent(e,s,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};var Cs=w.object({sdp:w.string().optional(),type:w.enum(["answer","offer","pranswer","rollback"])}),Oo=w.object({kind:w.literal("offer"),offer:Cs,targetId:w.string()}),To=w.object({kind:w.literal("answer"),answer:Cs,targetId:w.string()}),Zr=w.object({candidate:w.string().optional(),sdpMLineIndex:w.number().nullish(),sdpMid:w.string().nullish(),usernameFragment:w.string().nullish()}),Co=w.object({kind:w.literal("icecandidate"),candidate:Zr,targetId:w.string()}),Mo=w.object({kind:w.literal("text"),text:w.string().min(1)}),Po=w.object({kind:w.literal("exchange-ice"),targetId:w.string()}),Eo=w.object({kind:w.literal("offer"),offer:Cs,originId:w.string()}),Ao=w.object({kind:w.literal("answer"),answer:Cs,originId:w.string()}),Io=w.object({kind:w.literal("icecandidate"),candidate:Zr,originId:w.string()}),No=w.object({kind:w.literal("text"),text:w.string(),clientId:w.string()}),Ro=w.object({kind:w.literal("player-connect"),connectedId:w.string(),players:w.array(w.string())}),Lo=w.object({kind:w.literal("player-disconnect"),disconnectedId:w.string(),players:w.array(w.string())}),Fr=w.object({kind:w.literal("void:rpc:call"),signalName:w.string().min(1),args:w.array(w.unknown())}),jr=w.discriminatedUnion("kind",[Eo,Ao,Io,No,Ro,Lo]);w.discriminatedUnion("kind",[Oo,To,Co,Mo,Po]);var xi=D.BLACK;console.vis=()=>{throw new Error("Not in game update or paint code")};var xs=class{constructor(){p(this,"label","VoidConsoleVisWriterSystem")}update(e,s){console.vis=(i,r="")=>{let n=new Error().stack.split(`
`),a=n.slice(0,n.length-1).join(`
`),o=`${r}${a}`;s.visualLogs[o]=new Q(i)}}};function he(t,e,s){return{color:{operation:t,srcFactor:e,dstFactor:s},alpha:{operation:t,srcFactor:e,dstFactor:s}}}var $t="premultipliedBlendSourceOver",$r=[$t,"copy","unPremultipliedBlend","additiveLighten","destinationOver","destinationIn","destinationOut","destinationAtop","sourceIn","sourceOut","sourceAtop"],ve={copy:he("add","one","zero"),premultipliedBlendSourceOver:he("add","one","one-minus-src-alpha"),unPremultipliedBlend:he("add","src-alpha","one-minus-src-alpha"),destinationOver:he("add","one-minus-dst-alpha","one"),sourceIn:he("add","dst-alpha","zero"),destinationIn:he("add","zero","src-alpha"),sourceOut:he("add","one-minus-dst-alpha","zero"),destinationOut:he("add","zero","one-minus-src-alpha"),sourceAtop:he("add","dst-alpha","one-minus-src-alpha"),destinationAtop:he("add","one-minus-dst-alpha","src-alpha"),additiveLighten:he("add","one","one")};function Te(t={}){return{shader:t.shader,blend:t.blend??$t}}var we=class{constructor(){p(this,"_dataView",new DataView(new ArrayBuffer(100*4))),p(this,"_byteOffset",0),p(this,"_floatAlignment",1);let e=new Uint32Array([287454020]);if(new Uint8Array(e.buffer)[0]!==68)throw new Error("System is not little endian. This is not supported.")}addf32(e){this._dataView.setFloat32(this._byteOffset,e,!0),this._byteOffset+=4,this._floatAlignment=Math.max(this._floatAlignment,1)}addvec2f(e,s){this._byteOffset%16>8&&(this._byteOffset+=16-this._byteOffset%16),this.addf32(e),this.addf32(s),this._floatAlignment=Math.max(this._floatAlignment,2)}addvec3f(e,s,i){this._byteOffset%16>4&&(this._byteOffset+=16-this._byteOffset%16),this.addf32(e),this.addf32(s),this.addf32(i),this._floatAlignment=Math.max(this._floatAlignment,4)}addvec4f(e,s,i,r){this._byteOffset%16>4&&(this._byteOffset+=16-this._byteOffset%16),this.addf32(e),this.addf32(s),this.addf32(i),this.addf32(r),this._floatAlignment=Math.max(this._floatAlignment,4)}addmat3x3f(e){this._byteOffset%16!==0&&(this._byteOffset+=16-this._byteOffset%16),new Float32Array(this._dataView.buffer,this._byteOffset,12).set(e),this._byteOffset+=4*12,this._floatAlignment=Math.max(this._floatAlignment,4)}get buffer(){return new Float32Array(this._dataView.buffer,0,this.paddedOffset)}get offset(){return this._byteOffset/4}get paddedOffset(){return this.offset%this._floatAlignment===0?this.offset:this.offset+(this._floatAlignment-this.offset%this._floatAlignment)}},ur=t=>{if(typeof t=="object"&&t!==null){if(typeof Object.getPrototypeOf=="function"){let e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}return Object.prototype.toString.call(t)==="[object Object]"}return!1},me=(...t)=>t.reduce((e,s)=>{if(Array.isArray(s))throw new TypeError("Arguments provided to ts-deepmerge must be objects, not arrays.");return Object.keys(s).forEach(i=>{["__proto__","constructor","prototype"].includes(i)||(Array.isArray(e[i])&&Array.isArray(s[i])?e[i]=me.options.mergeArrays?me.options.uniqueArrayItems?Array.from(new Set(e[i].concat(s[i]))):[...e[i],...s[i]]:s[i]:ur(e[i])&&ur(s[i])?e[i]=me(e[i],s[i]):e[i]=s[i]===void 0?me.options.allowUndefinedOverrides?s[i]:e[i]:s[i])}),e},{}),ai={allowUndefinedOverrides:!0,mergeArrays:!0,uniqueArrayItems:!0};me.options=ai;me.withOptions=(t,...e)=>{me.options=Object.assign(Object.assign({},ai),t);let s=me(...e);return me.options=ai,s};var _i={linear:t=>t,easeIn:t=>t*t,easeOut:t=>t*(2-t),easeInOut:t=>t<.5?2*t*t:-1+(4-2*t)*t,ease:ns([{x:.25,y:.1},{x:.25,y:1}]),quadIn:ns([{x:.55,y:.085},{x:.68,y:.53}]),quadOut:ns([{x:.25,y:.46},{x:.45,y:.94}])};function ns([{x:t,y:e},{x:s,y:i}]){if(!(t>=0&&t<=1&&s>=0&&s<=1))throw new Error(`CubicBezier x1 & x2 values must be { 0 < x < 1 }, got { x1 : ${t}, x2: ${s} }`);let r=1-(s=3*(s-t)-(t*=3))-t,n=1-(i=3*(i-e)-(e*=3))-e,a=0,o=0,c=0,l=0,d=0;return u=>{for(o=u,a=0;32>a;a++){if(1e-5>Math.abs(d=o*(o*(o*r+s)+t)-u))return o*(o*(o*n+i)+e);if(1e-5>Math.abs(l=o*(o*r*3+s*2)+t))break;o-=d/l}if((c=0)>(o=u))return 0;if((l=1)<o)return 1;for(;l>c&&!(1e-5>Math.abs((d=o*(o*(o*r+s)+t))-u));)u>d?c=o:l=o,o=.5*(l-c)+c;return o*(o*(o*n+i)+e)}}var zo=`struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) texcoord: vec2f
};

struct Uniforms {
  matrix: mat3x3f,
  color: vec4f
}

struct ColorMap {
  fromColor: vec4f,
  toColor: vec4f
}

@group(0) @binding(0) var<uniform> uni: Uniforms;

@group(1) @binding(0) var samp: sampler;
@group(1) @binding(1) var tex: texture_2d<f32>;
@group(1) @binding(2) var<storage, read> colorMapArray: array<ColorMap>;

@vertex fn vs( @location(0) pos: vec2f, @builtin(vertex_index) vertexIndex : u32 ) -> VertexOutput {
  // map the vertices of the quad to texture uv coordinates
  let texpos = array(
    vec2f( 0., 0. ),
    vec2f( 1., 0. ),
    vec2f( 1., 1. ),

    vec2f( 0., 0. ),
    vec2f( 1., 1. ),
    vec2f( 0., 1. ),
  );

  var output: VertexOutput;
  output.pos = vec4f(uni.matrix * vec3f(pos, 1),1);
  output.texcoord = texpos[vertexIndex];
  return output;
}

const THRESHOLD = vec4f(.001);

@fragment fn fs(input: VertexOutput) -> @location(0) vec4f {
  let colorMapCount = arrayLength(&colorMapArray);
  var rgba = textureSample(tex, samp, input.texcoord);

  for (var i = 0u; i < colorMapCount; i++) {
    let color = colorMapArray[i].fromColor;
    if all(abs(rgba - color) <= THRESHOLD)  {
      rgba = colorMapArray[i].toColor;
    }
  }

  if rgba[3] == 0 || uni.color[3] == 0 { discard; }
  let tint = vec4f(uni.color.rgb * uni.color.a, uni.color.a);
  return rgba * tint;
}`,Uo=`struct VertexOutput {
  @builtin(position) pos: vec4f,
};

struct Uniforms {
  matrix: mat3x3f,
  color: vec4f,
}

@group(0) @binding(0) var<uniform> uni: Uniforms;

@vertex fn vs( @location(0) pos: vec2f, @builtin(vertex_index) vertexIndex : u32 ) -> VertexOutput {
  var output: VertexOutput;
  output.pos = vec4f(uni.matrix * vec3f(pos, 1), 1);
  return output;
}

@fragment fn fs(input: VertexOutput) -> @location(0) vec4f {
  let a = uni.color[3];
  return vec4f(uni.color[0] * a, uni.color[1] * a,uni.color[2] * a, a);
}
`,Zo=`struct VertexOutput {
  @builtin(position) pos: vec4f,
};

struct Uniforms {
  transform: mat3x3f,
  view: mat3x3f,
  projection: mat3x3f,
  color: vec3f,
}

@group(0) @binding(0) var<uniform> uni: Uniforms;

@vertex fn vs(
  @location(0) pos: vec2f,
  @builtin(vertex_index) vertexIndex : u32
) -> VertexOutput {
  var combined: vec3f = uni.projection * uni.view * uni.transform * vec3f(pos, 1);
  var output: VertexOutput;
  output.pos = vec4f(combined, 1);
  return output;
}

@fragment fn fs(input: VertexOutput) -> @location(0) vec4f {
  return vec4f(uni.color, 1);
}`,Fo=`struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) texcoord: vec2f
};

struct Uniforms {
  matrix: mat3x3f,
  color: vec4f,
  uvs: vec4f
}

struct ColorMap {
  fromColor: vec4f,
  toColor: vec4f
}

@group(0) @binding(0) var<uniform> uni: Uniforms;

@group(1) @binding(0) var samp: sampler;
@group(1) @binding(1) var tex: texture_2d<f32>;
@group(1) @binding(2) var<storage, read> colorMapArray: array<ColorMap>;

@vertex fn vs( @location(0) pos: vec2f, @builtin(vertex_index) vertexIndex : u32 ) -> VertexOutput {
  let x0 = uni.uvs[0];
  let y0 = uni.uvs[1];
  let x1 = uni.uvs[2];
  let y1 = uni.uvs[3];

  // map the vertices of the quad to texture uv coordinates
  // these must match the order of the vertices, with y flipped
  let texpos = array(
    vec2f( x0, y0 ),
    vec2f( x1, y0 ),
    vec2f( x1, y1 ),

    vec2f( x0, y0 ),
    vec2f( x1, y1 ),
    vec2f( x0, y1 ),
  );

  var output: VertexOutput;
  output.pos = vec4f(uni.matrix * vec3f(pos, 1), 1);
  output.texcoord = texpos[vertexIndex];
  return output;
}

const THRESHOLD = vec4f(.001);

@fragment fn fs(input: VertexOutput) -> @location(0) vec4f {
  let colorMapCount = arrayLength(&colorMapArray);
  var rgba = textureSample(tex, samp, input.texcoord);

  for (var i = 0u; i < colorMapCount; i++) {
    let color = colorMapArray[i].fromColor;
    if all(abs(rgba - color) <= THRESHOLD)  {
      rgba = colorMapArray[i].toColor;
    }
  }

  if rgba[3] == 0 || uni.color[3] == 0 { discard; }
  let tint = vec4f(uni.color.rgb * uni.color.a, uni.color.a);
  return rgba * tint;
}`,_s=class{constructor(e){p(this,"to"),p(this,"from"),p(this,"color"),p(this,"thickness"),p(this,"material"),this.to=e.to,this.from=e.from,this.color=e.color??D.MAGENTA,this.thickness=e.thickness??3,this.material=e.material}getThickLinePoints(){let{to:e,from:s,thickness:i}=this,r=i/2,n=Math.atan2(e.y-s.y,e.x-s.x),a=r*Math.sin(n),o=-r*Math.cos(n);return[{x:s.x+a,y:s.y+o},{x:e.x+a,y:e.y+o},{x:e.x-a,y:e.y-o},{x:s.x-a,y:s.y-o}]}};function jo(t){let e=[],s=-1/0,i=-1/0,r=1/0,n=1/0;for(let c=1;c<t.length-1;c++)e.push(t[0],t[c],t[c+1]),r=Math.min(r,t[c].x,t[c+1].x),n=Math.min(n,t[c].y,t[c+1].y),s=Math.max(s,t[c].x,t[c+1].x),i=Math.max(i,t[c].y,t[c+1].y);let a=i-n,o=s-r;return{vertices:e,height:a,width:o,minX:r,minY:n,maxX:s,maxY:i}}function $o({radius:t=1,subdivisions:e=24,innerRadius:s=0,startAngle:i=0,endAngle:r=Math.PI*2}={}){let n=e*3*2,a=new Float32Array(e*2*3*2),o=0,c=(l,d)=>{a[o++]=l,a[o++]=d};for(let l=0;l<e;++l){let d=i+(l+0)*(r-i)/e,u=i+(l+1)*(r-i)/e,m=Math.cos(d),b=Math.sin(d),S=Math.cos(u),U=Math.sin(u);c(m*t,b*t),c(S*t,U*t),c(m*s,b*s),c(m*s,b*s),c(S*t,U*t),c(S*s,U*s)}return{vertices:a,verticesCount:n}}var pe,fe,as,V,os,ls,oi,Dr,Ut=class{constructor(e,s,i,r,n){G(this,oi),p(this,"device"),p(this,"context"),p(this,"canvas"),p(this,"pipelines"),p(this,"resolveTextureURL"),p(this,"textureCache",{}),p(this,"encoder"),p(this,"renderPass"),G(this,pe,[]),G(this,fe,{x:0,y:0,zoom:1,rotation:0,pivot:h(.5)}),G(this,as,xi),G(this,V,void 0),G(this,os,"linear"),G(this,ls,"linear"),this.device=e,e.lost.then(a=>{console.error(`WebGPU device was lost: ${a.message}`),console.warn(a.__brand,a.message,a.reason)}),this.context=s,this.canvas=i,K(this,V,{width:r.width,height:r.height}),this.canvas.width=O(this,V).width,this.canvas.height=O(this,V).height,this.resolveTextureURL=n,this.pipelines={};for(let a of $r){let o=ve[a];this.pipelines[a]={triangle:ae(e,Zo,{label:`Triangle-${a}`,blend:o}),rect:ae(e,Uo,{label:`Rect-${a}`,blend:o}),texture:ae(e,zo,{label:`Texture-${a}`,blend:o}),sprite:ae(e,Fo,{label:`Sprite-${a}`,blend:o})}}}get minFilter(){return O(this,os)}set minFilter(e){K(this,os,e)}get magFilter(){return O(this,ls)}set magFilter(e){K(this,ls,e)}resize(e){K(this,V,{width:e.width,height:e.height}),this.canvas.width=O(this,V).width,this.canvas.height=O(this,V).height}line(e,s){L(this.renderPass,"Call startFrame before lines");let i={height:O(this,V).height,width:O(this,V).width,pivot:e.pivot??h(0),rotation:e.rotation??0,scale:e.scale??h(1),skew:e.skew??h(0),x:e.x??0,y:e.y??0,z:e.z??0,material:e.material??Te()},r=new _s(e),n=Ge(O(this,V),e.camera??O(this,fe),i,s),a=new we;a.addmat3x3f(n),a.addvec4f(...r.color);let o=i.material.shader==null?this.pipelines[i.material.blend].rect:ae(this.device,i.material.shader,{label:"CustomLine",blend:ve[i.material.blend]}),c=r.getThickLinePoints(),l=new Float32Array([c[0].x,c[0].y,c[1].x,c[1].y,c[2].x,c[2].y,c[2].x,c[2].y,c[3].x,c[3].y,c[0].x,c[0].y]);O(this,pe).push({pipeline:o,uniformBuffer:a.buffer,vertices:l,verticesCount:6,zIndex:i.z})}polygon(e,s){L(this.renderPass,"Call startFrame before polygon");let i={points:e.points,color:e.color??D.MAGENTA,material:e.material??Te(),pivot:e.pivot??h(.5),rotation:e.rotation??0,scale:e.scale??h(1),skew:e.skew??h(0),x:e.x??0,y:e.y??0,z:e.z??0,camera:e.camera??O(this,fe)},{vertices:r,height:n,width:a}=jo(i.points),o=i.material.shader==null?this.pipelines[i.material.blend].rect:ae(this.device,i.material.shader,{label:"CustomPolygon",blend:ve[i.material.blend]}),c=Ge(O(this,V),i.camera,{...i,height:n,width:a},s),l=new we;l.addmat3x3f(c),l.addvec4f(...i.color),O(this,pe).push({pipeline:o,uniformBuffer:l.buffer,vertices:new Float32Array(r.flatMap(d=>[d.x,d.y])),verticesCount:r.length,zIndex:i.z??0})}startFrame(){this.encoder=this.device.createCommandEncoder(),this.renderPass=this.encoder.beginRenderPass({colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",clearValue:this.clearColor,storeOp:"store"}]})}endFrame(){if(!this.renderPass||!this.encoder)throw new Error("beginFrame must be called before endFrame");O(this,pe).sort((e,s)=>e.zIndex-s.zIndex).forEach(oe(this,oi,Dr).bind(this)),this.renderPass.end(),this.device.queue.submit([this.encoder.finish()]),K(this,pe,[])}async preloadTextures(e){let s={};return await Promise.all(e.map(i=>this.loadTexture(this.resolveTextureURL(i)).then(r=>{s[i]={width:r.width,height:r.height,path:i}}))),s}vertices(e,s){L(this.renderPass,"Call startPass first");let i=this.device.createBuffer({label:"Vertex buffer",size:s.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(i,0,s),this.renderPass.setVertexBuffer(0,i),this.renderPass.draw(e)}gob(e){if(e.isVisible){!e.width&&e.kids.length===0&&ci(`gob-width-${e.id}`,`Gob ${e.label||e.id} has no width and no kids. It won't be drawn.`),e.texturePath?e.spriteFrame?this.sprite(e.texturePath,{...e,z:e.z,frame:e.spriteFrame},e.transformMatrix):this.texture(e.texturePath,e,e.transformMatrix):e.text?this.text(e.text,{...e,z:e.z,...e.textOpts},e.transformMatrix):this.rect(e,e.transformMatrix);for(let s of e.kids)this.gob(s)}}rect(e,s){L(this.renderPass,"Call startFrame before rect");let i={color:D.MAGENTA,x:0,y:0,z:0,scale:h(1),skew:h(0),rotation:0,width:100,height:100,pivot:h(.5),material:Te()},{color:r,width:n,height:a,material:o,...c}={...i,...Jt({...e,z:e?.z})},l=Ge(O(this,V),e?.camera??O(this,fe),{...c,height:a,width:n},s),d=new we;d.addmat3x3f(l),d.addvec4f(...r);let u=o.shader==null?this.pipelines[o.blend].rect:ae(this.device,o.shader,{label:"CustomRect",blend:ve[o.blend]}),m=c.z??0,b=new Float32Array([0,0,n,0,n,a,0,0,n,a,0,a]);O(this,pe).push({pipeline:u,uniformBuffer:d.buffer,vertices:b,verticesCount:6,zIndex:m})}texture(e,s,i){L(this.renderPass,"Call startFrame before texture");let r=this.resolveTextureURL(e),n=this.textureCache[r.href];if(!n){this.loadTexture(r);return}if(n.kind==="loading")return;let a={color:D.WHITE,x:0,y:0,z:0,width:n.texture.width,height:n.texture.height,scale:h(1),skew:h(0),rotation:0,pivot:h(.5),material:Te(),colorMap:[],ignoreAspectRatio:!1};if(s&&!s.ignoreAspectRatio){let{width:U,height:F}=a;s.height&&(a.width=U*s.height/F),s.width&&(a.height=F*s.width/U)}let{color:o,material:c,...l}={...a,...Jt({...s,z:s?.z})},d=Ge(O(this,V),s?.camera??O(this,fe),l,i),u=new we;u.addmat3x3f(d),u.addvec4f(...o);let m=c.shader==null?this.pipelines[c.blend].texture:ae(this.device,c.shader,{label:"CustomTexture",blend:ve[c.blend]}),b=l.z??0,S=new Float32Array([0,0,l.width,0,l.width,l.height,0,0,l.width,l.height,0,l.height]);O(this,pe).push({pipeline:m,uniformBuffer:u.buffer,vertices:S,verticesCount:6,zIndex:b,texture:n.texture,colorMap:l.colorMap})}text(e,s,i){if(L(this.renderPass,"Call startFrame before text"),!e)return;let r={color:D.WHITE,x:0,y:0,z:0,scale:h(1),skew:h(0),pivot:h(.5),rotation:0,fontSize:24,fontFamily:"Helvetica"},n=s?.material??Te(),a={...r,...Jt({...s,z:s?.z})},{canvas:o,width:c,height:l}=fr(e,a),d=Vr(this.device,o),u=n.shader==null?this.pipelines[n.blend].texture:ae(this.device,n.shader,{label:"CustomText",blend:ve[n.blend]}),m=new we,b=Ge(O(this,V),s?.camera??O(this,fe),{...a,height:l,width:c},i);m.addmat3x3f(b),m.addvec4f(...D.WHITE);let S=a.z??0,U=new Float32Array([0,0,c,0,c,l,0,0,c,l,0,l]);return O(this,pe).push({pipeline:u,uniformBuffer:m.buffer,vertices:U,verticesCount:6,zIndex:S,texture:d}),{width:c,height:l}}measureText(e,s){return ks(e,s)}sprite(e,s,i){L(this.renderPass,"Call startFrame before texture");let r=this.resolveTextureURL(e),n=this.textureCache[r.href];if(!n){this.loadTexture(r);return}if(n.kind==="loading")return;let a={color:D.WHITE,x:0,y:0,z:0,width:n.texture.width,height:n.texture.height,scale:h(1),skew:h(0),rotation:0,pivot:h(.5),material:Te(),ignoreAspectRatio:!0,frame:{pos:{x:0,y:0},width:n.texture.height,height:n.texture.height},colorMap:[]},{color:o,material:c,frame:l,...d}={...a,...Jt(s)},u=l.pos.x/n.texture.width,m=l.pos.y/n.texture.height,b=u+l.width/n.texture.width,S=m+l.height/n.texture.height,U=Ge(O(this,V),s?.camera??O(this,fe),d,i),F=new we;F.addmat3x3f(U),F.addvec4f(...o),F.addvec4f(u,m,b,S);let ne=c.shader==null?this.pipelines[c.blend].sprite:ae(this.device,c.shader,{label:"CustomTexture",blend:ve[c.blend]}),R=d.z??0,ee=new Float32Array([0,0,d.width,0,d.width,d.height,0,0,d.width,d.height,0,d.height]);O(this,pe).push({pipeline:ne,uniformBuffer:F.buffer,vertices:ee,verticesCount:6,zIndex:R,texture:n.texture,colorMap:d.colorMap})}circle(e={},s){L(this.renderPass,"Call startFrame before circle");let i={color:e.color??D.MAGENTA,x:e.x??0,y:e.y??0,z:e.z??0,scale:e.scale??h(1),skew:e.skew??h(0),pivot:e.pivot??h(.5),rotation:e.rotation??0,material:e.material??Te(),radius:e.radius??100,startAngle:e.startAngle??0,endAngle:e.endAngle??Math.PI*2,innerRadius:e.innerRadius??0,subdivisions:e.subdivisions??24,camera:e.camera??O(this,fe)};i.pivot=h(dr(i.pivot.x),dr(i.pivot.y));let r=i.material.shader==null?this.pipelines[i.material.blend].rect:ae(this.device,i.material.shader,{label:"CustomCircle",blend:ve[i.material.blend]}),n=Ge(O(this,V),i.camera,{...i,height:i.radius,width:i.radius},s),a=new we;a.addmat3x3f(n),a.addvec4f(...i.color);let{vertices:o,verticesCount:c}=$o(i);O(this,pe).push({pipeline:r,uniformBuffer:a.buffer,vertices:o,verticesCount:c,zIndex:i.z??0})}get defaultPipeline(){return this.pipelines[$t].texture}get camera(){return O(this,fe)}set camera(e){K(this,fe,e)}get clearColor(){return O(this,as)}set clearColor(e){K(this,as,e)}async loadTexture(e){let s=this.textureCache[e.href];if(s?.kind==="loaded")return s.texture;this.textureCache[e.href]={kind:"loading"};let i=await Do(e),r=this.device.createTexture({label:e.href,format:"rgba8unorm",size:[i.width,i.height],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return this.device.queue.copyExternalImageToTexture({source:i,flipY:!1},{texture:r,premultipliedAlpha:!0},{width:i.width,height:i.height}),this.textureCache[e.href]={texture:r,kind:"loaded"},r}};pe=new WeakMap,fe=new WeakMap,as=new WeakMap,V=new WeakMap,os=new WeakMap,ls=new WeakMap,oi=new WeakSet,Dr=function(t){if(this.renderPass.setPipeline(t.pipeline),Br(this.device,t.pipeline,this.renderPass,t.uniformBuffer,0),t.texture){let e=Wr(this.device,t.pipeline,t.texture,1,this.minFilter,this.magFilter,t.colorMap);this.renderPass.setBindGroup(1,e)}this.vertices(t.verticesCount,t.vertices)};async function Do(t){let e=await(await fetch(t)).blob();try{return await createImageBitmap(e,{colorSpaceConversion:"none"})}catch{let s=new Error(`Failed to create image from ${t}`);throw s.name="InvalidFile",s}}async function Bo(t,e,s){L(navigator.gpu,"WebGPU is not available"),L(t,"Canvas element is required"),L(t.getContext,"Canvas element is not a canvas"),t.width=e.width,t.height=e.height;let i=await navigator.gpu.requestAdapter();L(i,"GPU Adapter not found");let r=await i.requestDevice();L(r,`Couldn't get device from adapter: ${i}`);let n=t.getContext("webgpu");L(n,"Couldn't get webgpu context from canvas");let a=navigator.gpu.getPreferredCanvasFormat();return n.configure({device:r,format:a,alphaMode:"premultiplied"}),new Ut(r,n,t,e,s)}function Ge(t,e,s,i){L(s.pivot,"Pivot is required to generate matrix");let r=Gr(t,s,e,i);return Wo(s.pivot,s.width,s.height,r),r}function Wo(t,e,s,i){let r=h(t).scale(-e,-s);Xe(i,r,i)}var Jt=t=>{let e={};for(let s in t)t[s]!==void 0&&(e[s]=t[s]);return e};function dr(t){return 2*t-1}function Vo(t,e,s,i){return[(t+1)*s/2,(-e+1)*i/2]}function qo(t,e,s,i){return[t*2/s-1,1-e*2/i]}function Br(t,e,s,i,r=0){let n=t.createBuffer({label:"Uniforms",size:i.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});t.queue.writeBuffer(n,0,i);let a=t.createBindGroup({layout:e.getBindGroupLayout(r),entries:[{binding:r,resource:{buffer:n}}]});s.setBindGroup(r,a)}function Wr(t,e,s,i=0,r="linear",n="linear",a=[]){let o=t.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:r,magFilter:n}),c=t.createBuffer({label:"Texture Color Map Storage Buffer",size:(a.length||1)*32,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),l=new Float32Array(c.size/4);return a.forEach((d,u)=>{l.set(d.from,u*8),l.set(d.to,u*8+4)}),t.queue.writeBuffer(c,0,l),t.createBindGroup({layout:e.getBindGroupLayout(i),entries:[{binding:0,resource:o},{binding:1,resource:s.createView()},{binding:2,resource:{buffer:c}}]})}function Vr(t,e){let{width:s,height:i}=e,r=t.createTexture({label:"",size:{width:s,height:i},format:"bgra8unorm",sampleCount:1,mipLevelCount:1,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});return t.queue.copyExternalImageToTexture({source:e,flipY:!1},{texture:r,premultipliedAlpha:!0},{width:s,height:i}),r}function ae(t,e,s={}){let i={arrayStride:8,attributes:[{format:"float32x2",offset:0,shaderLocation:0}]},{blend:r,vertexFn:n="vs",fragmentFn:a="fs",label:o,shaderLabel:c,vertexLayout:l,format:d}={vertexFn:"vs",fragmentFn:"fs",format:s.format||navigator.gpu.getPreferredCanvasFormat(),blend:ve[$t],vertexLayout:i,label:"unlabelled pipeline",shaderLabel:s.shaderLabel||e.slice(0,40),...s},u=t.createShaderModule({label:c,code:e});return t.createRenderPipeline({label:o,layout:"auto",vertex:{module:u,entryPoint:n,buffers:[l]},fragment:{module:u,entryPoint:a,targets:[{format:d,blend:r}]}})}function qr(t,e){let s=Pe(),i=h(e.width,e.height).mutScale(t.pivot);return Xe(s,i,s),gt(s,t.rotation,s),Ft(s,{x:t.zoom,y:t.zoom},s),Xe(s,{x:-t.x,y:-t.y},s),s}function Gr(t,e,s,i){let r=i??Yr({x:e.x,y:e.y},e.rotation,e.scale,e.skew),n=qr(s,t),a=Kr(t);return cs(cs(a,n),r)}function Yr(t,e,s,i,r){let n=r?wr(r):Pe();return Xe(n,t,n),n[0]=Math.cos(e+i.y)*s.x,n[1]=Math.sin(e+i.y)*s.x,n[4]=-Math.sin(e+i.x)*s.y,n[5]=Math.cos(e+i.x)*s.y,n}function Kr(t){let{width:e,height:s}=t,i=gi({x:-1,y:1});return Ft(i,{x:2/e,y:-2/s},i),i}function Go(t){return new Promise((e,s)=>{t.toBlob(async i=>{i?e(i):s("Couldn't create blob for screenshot")},"image/png")})}function Yo(t){if(!(t instanceof Ut))throw new Error("WebGpuPainter is the only supported painter for screenshots.");let e=document.createElement("canvas");e.width=t.canvas.width,e.height=t.canvas.height;let s=e.getContext("2d");if(!s)throw new Error("Failed to create a 2d context for screenshot");return s.drawImage(t.canvas,0,0),Go(e)}var Ko=Object.defineProperty,Xo=(t,e,s)=>e in t?Ko(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Jo=(t,e,s)=>(Xo(t,typeof e!="symbol"?e+"":e,s),s),W=class{constructor(){Jo(this,"listeners",[])}connect(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(s=>s!==e)}}emit(...e){for(let s of this.listeners)s(...e)}disconnect(){this.listeners=[]}};var Ho=Object.defineProperty,Qo=(t,e,s)=>e in t?Ho(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,f=(t,e,s)=>(Qo(t,typeof e!="symbol"?e+"":e,s),s),er=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},_=(t,e,s)=>(er(t,e,"read from private field"),s?s.call(t):e.get(t)),I=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},ue=(t,e,s,i)=>(er(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),A=(t,e,s)=>(er(t,e,"access private method"),s),Si=class{constructor(e){f(this,"behaviors",[]),f(this,"history",new Map),this.behaviors=e;for(let s of e)if(s.id&&s.tag&&console.warn(`Ignoring tag ${s.tag} on behavior ${s.id} because it has an id`),!s.id&&!s.tag)throw new Error(`Behavior has no id or tag - ${JSON.stringify(s)}`)}update(e,s){var i,r;if(s.scene.kids.length==0)return;let n=performance.now(),a=s.scene.findVisible().map(u=>u.id),o=s.scene.all(u=>!!u.isDestroyed),c=o.map(u=>u.id),l=Number(s.frame),d=[];for(let u of this.history.keys()){let m=this.history.get(u);!a.includes(u)&&m&&m.hide<m.show&&(d.push(u),m.hide=l)}for(let u of a)if(!this.history.has(u))this.history.set(u,{start:l,show:l,hide:-1});else{let m=this.history.get(u);m&&m.hide>m.show&&(m.show=l)}performance.now()-n>10&&ci(`Finding visible gobs in scene took ${performance.now()-n}ms`,"visibleGobs");for(let u of this.behaviors){for(let m of ki(u,s.scene))u.start&&((i=this.history.get(m.id))==null?void 0:i.start)==l&&u.start(m,e,s),u.onShow&&((r=this.history.get(m.id))==null?void 0:r.show)==l&&u.onShow(m,e,s),u.update&&u.update(m,e,s),u.destroy&&c.includes(m.id)&&u.destroy(m,e,s);if(u.onHide)for(let m of d){let b=s.scene.find(m);if(!b)throw new Error(`Gob not found: ${m}`);(b.id==u.id||b.tags&&u.tag&&b.tags.includes(u.tag))&&u.onHide(b,e,s)}}for(let u of o){if(!u.parent)throw new Error("Can't destroy scene");u.parent.kids.splice(u.parent.kids.indexOf(u),1)}}paint(e,s){if(!s.scene.kids.length){for(let i of this.behaviors)if(i.paint)for(let r of ki(i,s.scene))i.paint(r,e,s)}}destroy(e,s){for(let i of this.behaviors)if(i.destroy&&s.scene)for(let r of ki(i,s.scene))i.destroy(r,e,s)}};function ki(t,e){if(t.id){let s=e.find(t.id);return s?[s].filter(i=>i.isVisibleInTree):[]}else if(t.tag)return e.findTag(t.tag).filter(s=>s.isVisibleInTree);return[]}function Xl(t,e){return t.x<e.x+e.width&&e.x<t.x+t.width&&t.y<e.y+e.height&&e.y<t.y+t.height}function el(t,e){return e.x<=t.x&&t.x<=e.x+e.width&&e.y<=t.y&&t.y<=e.y+e.height}function Xr(t,e){let[s,i,r,n]=e,a=Ot(s,i,r),o=Ot(s,r,n),c=Ot(s,i,t),l=Ot(i,r,t),d=Ot(r,n,t),u=Ot(n,s,t);return c+l+d+u<=a+o+1e-10}function Ot(t,e,s){return Math.abs(e.x*t.y-t.x*e.y+(s.x*e.y-e.x*s.y)+(t.x*s.y-s.x*t.y))/2}var Dt,Ps,Bt,Es,Oi=class{constructor(){I(this,Dt),I(this,Bt),f(this,"snapshots",[jt(),jt()]),f(this,"isCatchupFrame",!1)}isKeyDown(e){return this.isCatchupFrame?!1:this.snapshots[0].keyboard.down.has(e)&&(!this.snapshots[1].keyboard.down.has(e)||this.snapshots[1].keyboard.up.has(e))}isKeyHeld(e){return this.snapshots[0].keyboard.down.has(e)}isKeyUp(e){return this.isCatchupFrame?!1:this.snapshots[0].keyboard.up.has(e)&&(!this.snapshots[1].keyboard.up.has(e)||this.snapshots[0].keyboard.down.has(e))}get snapshot(){return this.snapshots[0]}get keyboard(){return this.snapshots[0].keyboard}get gamepadCount(){return this.snapshot.gamepads.length}get mouse(){return{...this.snapshots[0].mouse,down:this.isCatchupFrame?new Set:this.snapshots[0].mouse.down,up:this.isCatchupFrame?new Set:this.snapshots[0].mouse.up}}get isMouseDown(){return this.isCatchupFrame?!1:this.snapshots[0].mouse.down.has(j.Left)&&(!this.snapshots[1].mouse.down.has(j.Left)||this.snapshots[1].mouse.up.has(j.Left))}get isMouseHeld(){return this.snapshots[0].mouse.down.has(j.Left)}get isMouseUp(){return this.isCatchupFrame?!1:this.snapshots[0].mouse.up.has(j.Left)&&(!this.snapshots[1].mouse.up.has(j.Left)||this.snapshots[0].mouse.down.has(j.Left))}get gamepads(){let e=this,s=[];for(let i=0;i<this.gamepadCount;i++){let r={isButtonDown(n){return e.isButtonDown(n,i)},isButtonHeld(n){return e.isButtonHeld(n,i)},isButtonUp(n){return e.isButtonUp(n,i)},get leftStick(){var n;return A(n=e,Bt,Es).call(n,i,ut.Left)},get rightStick(){var n;return A(n=e,Bt,Es).call(n,i,ut.Right)}};s.push(r)}return s}isButtonDown(e,s=0){if(this.isCatchupFrame||this.snapshot.gamepads.length==0)return!1;let i=A(this,Dt,Ps).call(this,s);if(!i[0])throw new Error(`Tried to get gamepad for index: ${s} but it doesn't exist in snapshot: ${JSON.stringify(this.snapshot)}`);let r=i[0].down.has(e),n=i[1]&&i[1].down.has(e);return r&&!n}isButtonHeld(e,s=0){return this.snapshot.gamepads.length==0?!1:A(this,Dt,Ps).call(this,s)[0].down.has(e)}isButtonUp(e,s=0){var i;if(this.snapshot.gamepads.length==0||this.isCatchupFrame)return!1;let r=A(this,Dt,Ps).call(this,s),n=(i=r[1])==null?void 0:i.down.has(e);return(r[0].up.has(e)||n&&!r[0].down.has(e))??!1}getStick(e,s=0){return A(this,Bt,Es).call(this,s,e)}get leftStick(){return this.getStick(ut.Left)}get rightStick(){return this.getStick(ut.Right)}isMouseOver(e){return e instanceof Os?Xr(this.mouse,e.bounds().points):e instanceof Q?Xr(this.mouse,e.bounds()):el(this.mouse,e)}isMouseOut(e){return!this.isMouseOver(e)}};Dt=new WeakSet,Ps=function(t){let e=this.snapshots[0].gamepads[t];if(!e)throw new Error(`Can't find gamepad with index: ${t}. gamepads: ${JSON.stringify(this.snapshot.gamepads)}`);return[e,this.snapshots[1].gamepads[t]]},Bt=new WeakSet,Es=function(t,e){var s;let i=(s=this.snapshot.gamepads[t].axes.find(r=>r.hand==e))==null?void 0:s.value;if(!i)throw new Error(`Tried to get gamepad for index: ${t} but it doesn't exist in snapshot: ${JSON.stringify(this.snapshot)}`);return h(i)};var Ti=class{constructor(){f(this,"snapshot",jt()),f(this,"bytes"),this.bytes=new Uint8Array(Ee.byteLength(us,ds,bi))}readInput(){return Ee.encodeSnapshot(this.bytes,this.snapshot),this.bytes}pollGamepads(){}resize(){}destroy(){}},tl=t=>t[1]!==null&&t[1]!==void 0;function sl(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();let t=new Date().getTime(),e=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){let i=Math.random()*16;return t>0?(i=(t+i)%16|0,t=Math.floor(t/16)):(i=(e+i)%16|0,e=Math.floor(e/16)),(s==="x"?i:i&3|8).toString(16)})}function dn(t,e,s={}){let{host:i,path:r,protocol:n,room:a,party:o,query:c}=t,l=i.replace(/^(http|https|ws|wss):\/\//,"");if(l.endsWith("/")&&(l=l.slice(0,-1)),r&&r.startsWith("/"))throw new Error("path must not start with a slash");let d=o??"main",u=r?`/${r}`:"",m=n||(l.startsWith("localhost:")||l.startsWith("127.0.0.1:")||l.startsWith("192.168.")||l.startsWith("10.")||l.startsWith("172.")&&l.split(".")[1]>="16"&&l.split(".")[1]<="31"||l.startsWith("[::ffff:7f00:1]:")?e:e+"s"),b=`${m}://${l}/${o?`parties/${o}`:"party"}/${a}${u}`,S=(F={})=>`${b}?${new URLSearchParams([...Object.entries(s),...Object.entries(F).filter(tl)])}`,U=typeof c=="function"?async()=>S(await c()):S(c);return{host:l,path:u,room:a,name:d,protocol:m,partyUrl:b,urlProvider:U}}var il=class extends Ur{constructor(t){let e=Jr(t);super(e.urlProvider,e.protocols,e.socketOptions),f(this,"_pk"),f(this,"_pkurl"),f(this,"name"),f(this,"room"),f(this,"host"),f(this,"path"),this.partySocketOptions=t,this.setWSProperties(e)}updateProperties(t){let e=Jr({...this.partySocketOptions,...t,host:t.host??this.host,room:t.room??this.room,path:t.path??this.path});this._url=e.urlProvider,this._protocols=e.protocols,this._options=e.socketOptions,this.setWSProperties(e)}setWSProperties(t){let{_pk:e,_pkurl:s,name:i,room:r,host:n,path:a}=t;this._pk=e,this._pkurl=s,this.name=i,this.room=r,this.host=n,this.path=a}reconnect(t,e){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(t,e)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(t,e){let s=dn(t,"http"),i=typeof s.urlProvider=="string"?s.urlProvider:await s.urlProvider();return(t.fetch??fetch)(i,e)}};function Jr(t){let{id:e,host:s,path:i,party:r,room:n,protocol:a,query:o,protocols:c,...l}=t,d=e||sl(),u=dn(t,"ws",{_pk:d});return{_pk:d,_pkurl:u.partyUrl,name:u.name,room:u.room,host:u.host,path:u.path,protocols:c,socketOptions:l,urlProvider:u.urlProvider}}var _e,Re,re,Ct,Wt,Ci,hn,Mi,pn,Pi,fn,Ei,mn,Ai,Hr,Ii,Qr,Ni,en,Ri,tn,Li,sn,Vt,Ms,zi,rn,Ui,nn,gn=class yn{constructor(){I(this,Ct),I(this,Ci),I(this,Mi),I(this,Pi),I(this,Ei),I(this,Ai),I(this,Ii),I(this,Ni),I(this,Ri),I(this,Li),I(this,Vt),I(this,zi),I(this,Ui),I(this,_e,new Map),I(this,Re,new Map),I(this,re,void 0),f(this,"iceServers",[{urls:"stun:stun.l.google.com:19302"}]),f(this,"onRTCMessage",new W),f(this,"onRTCOpen",new W),f(this,"onRTCClose",new W),f(this,"onRTCError",new W),f(this,"onPartyMessage",new W),f(this,"onPartyOpen",new W),f(this,"onPartyClose",new W),f(this,"onPartyError",new W),f(this,"onPartyPeerConnect",new W),f(this,"onPartyPeerDisconnect",new W),f(this,"peers",[])}get partyReadyState(){var e;return(e=_(this,re))==null?void 0:e.readyState}get peerId(){var e;return(e=_(this,re))==null?void 0:e.id}get roomId(){var e;return(e=_(this,re))==null?void 0:e.room}connect(e){var s;this.partyReadyState===((s=_(this,re))==null?void 0:s.OPEN)&&this.disconnect(),ue(this,re,new il({host:yn.partyUrl,room:e??ui()})),_(this,re).onmessage=A(this,Ei,mn).bind(this),_(this,re).onclose=A(this,Mi,pn).bind(this),_(this,re).onopen=A(this,Ci,hn).bind(this),_(this,re).onerror=A(this,Pi,fn).bind(this)}disconnect(...e){var s;(s=_(this,re))==null||s.close(...e)}sendWebsocketMessage(e){A(this,Ct,Wt).call(this,{kind:"text",text:e})}sendPeersReliable(e,s=this.peers){var i;for(let r of s){if(r===this.peerId)continue;let n=_(this,_e).get(r);(i=n?.reliable)==null||i.send(e)}}sendPeersUnreliable(e,s=this.peers){var i;for(let r of s){if(r===this.peerId)continue;let n=_(this,_e).get(r);(i=n?.unreliable)==null||i.send(e)}}};_e=new WeakMap,Re=new WeakMap,re=new WeakMap,Ct=new WeakSet,Wt=function(t){var e;(e=_(this,re))==null||e.send(JSON.stringify(t))},Ci=new WeakSet,hn=function(t){this.onPartyOpen.emit(t)},Mi=new WeakSet,pn=function(t){this.onPartyClose.emit(t)},Pi=new WeakSet,fn=function(t){this.onPartyError.emit(t)},Ei=new WeakSet,mn=function(t){try{let e=JSON.parse(t.data),s=jr.parse(e);switch(s.kind){case"player-connect":return A(this,Ai,Hr).call(this,s);case"player-disconnect":return A(this,Ii,Qr).call(this,s);case"offer":return A(this,Ni,en).call(this,s);case"icecandidate":return A(this,Ri,tn).call(this,s);case"answer":return A(this,Li,sn).call(this,s);case"text":return this.onPartyMessage.emit(s.text,s.clientId)}}catch(e){console.error("Something happened parsing websocket message",t.data,e)}},Ai=new WeakSet,Hr=function(t){this.peers=t.players;for(let e of t.players)e!==this.peerId&&!_(this,Re).has(e)&&A(this,Ui,nn).call(this,e);this.onPartyPeerConnect.emit(t.connectedId,this.peers)},Ii=new WeakSet,Qr=function(t){var e;this.peers=t.players,(e=_(this,Re).get(t.disconnectedId))==null||e.close(),_(this,Re).delete(t.disconnectedId),this.onPartyPeerDisconnect.emit(t.disconnectedId,this.peers)},Ni=new WeakSet,en=async function(t){Zt(t.originId!==this.peerId,"Should not have received offer from self");let e=_(this,Re).get(t.originId);L(e,`Failed to handle party offer - peer is not initialized for: ${t.originId}`),await e.setRemoteDescription(t.offer);let s=await e.createAnswer();await e.setLocalDescription(s),A(this,Ct,Wt).call(this,{kind:"answer",answer:s,targetId:t.originId})},Ri=new WeakSet,tn=async function(t){let e=_(this,Re).get(t.originId);L(e,`Failed to handle party ICE candidate - peer is not initialized for: ${t.originId}`),await e.addIceCandidate(t.candidate)},Li=new WeakSet,sn=function(t){Zt(t.originId!==this.peerId,"Should not have received answer from self");let e=_(this,Re).get(t.originId);L(e,`Failed to handle party answer - peer is not initialized for: ${t.originId}`),e.setRemoteDescription(t.answer)},Vt=new WeakSet,Ms=function(t,e){t.onopen=()=>{var s,i;t.ordered?_(this,_e).set(e,{reliable:t,unreliable:(s=_(this,_e).get(e))==null?void 0:s.unreliable}):_(this,_e).set(e,{reliable:(i=_(this,_e).get(e))==null?void 0:i.reliable,unreliable:t});let r=_(this,_e).get(e);r&&r.reliable&&r.unreliable&&this.onRTCOpen.emit(e)},t.onmessage=s=>{if(typeof s.data=="string")try{let i=JSON.parse(s.data),r=Fr.parse(i),n=xe.registered.get(r.signalName);n?n.signal._call(r.args,e):console.warn("RPC: Failed to find registered signal with name ",r.signalName);return}catch{}this.onRTCMessage.emit(s.data,e)},t.onclose=()=>{_(this,_e).delete(e),this.onRTCClose.emit(e)},t.onerror=s=>{this.onRTCError.emit(e,s)}},zi=new WeakSet,rn=async function(t,e){let s=await t.createOffer();await t.setLocalDescription(s),A(this,Ct,Wt).call(this,{kind:"offer",offer:s,targetId:e})},Ui=new WeakSet,nn=async function(t){L(this.peerId,"Failed to create peer - peer id missing");let e=new RTCPeerConnection({iceServers:this.iceServers});if(_(this,Re).set(t,e),e.ondatachannel=s=>{A(this,Vt,Ms).call(this,s.channel,t)},t.localeCompare(this.peerId)>0){let s=e.createDataChannel("VoidChannelReliable"),i=e.createDataChannel("VoidChannelUnreliable",{ordered:!1,maxRetransmits:0});A(this,Vt,Ms).call(this,s,t),A(this,Vt,Ms).call(this,i,t),await A(this,zi,rn).call(this,e,t)}e.onicecandidate=s=>{s.candidate&&A(this,Ct,Wt).call(this,{kind:"icecandidate",candidate:s.candidate.toJSON(),targetId:t})}},f(gn,"partyUrl","wss://void.neilsarkar.partykit.dev");var rl=gn,Zi=class Fi{static register(e="reliable",s="local"){return(i,r)=>{let n=i[r];Zt(n instanceof bn,`Expected ${r} to be a static Signal`),n._name=r,Fi.registered.has(r)&&console.warn(`WARN: RPC signal already registered with name '${r}'. Registering two with the same name will override one. Please rename one to avoid conflicts`),Fi.registered.set(r,{transferMode:e,sync:s,signal:n})}}};f(Zi,"multiplayer",new rl),f(Zi,"registered",new Map);var xe=Zi,As,Is,ji,vn=class wn{constructor(e){I(this,Is),f(this,"_name",""),I(this,As,void 0),ue(this,As,e)}_call(e,s){let i=wn.context;i.peerId=s,_(this,As).call(this,i,...e)}emit(...e){let s=xe.registered.get(this._name);L(s,"Expected RPC signal to be registered"),s.sync==="local"&&this._call(e,xe.multiplayer.peerId);let i=A(this,Is,ji).call(this,this._name,e);s.transferMode==="reliable"?xe.multiplayer.sendPeersReliable(i):xe.multiplayer.sendPeersUnreliable(i)}emitId(e,...s){let i=xe.registered.get(this._name);L(i,"Expected RPC signal to be registered"),i.sync==="local"&&this._call(s,xe.multiplayer.peerId);let r=A(this,Is,ji).call(this,this._name,s);i.transferMode==="reliable"?xe.multiplayer.sendPeersReliable(r,[e]):xe.multiplayer.sendPeersUnreliable(r,[e])}};As=new WeakMap,Is=new WeakSet,ji=function(t,e=[]){return JSON.stringify({kind:"void:rpc:call",signalName:t,args:e})},f(vn,"context");var bn=vn,$i=class{texture(){}sprite(){}circle(){}rect(){}triangle(){}polygon(){}gob(){}text(){}line(){}startFrame(){}endFrame(){}resize(){}measureText(){return{width:0,height:0}}async preloadTextures(){return{}}get width(){return 0}get height(){return 0}get camera(){return{x:0,y:0,zoom:1,rotation:0,pivot:h(.5)}}set camera(e){}get clearColor(){return xi}set clearColor(e){}},Di=class{constructor(){f(this,"label","VoidSceneSystem")}paint(e,s){s.scene.kids.length&&e.gob(s.scene)}},Bi,xn,Wi=class{constructor(){I(this,Bi),f(this,"label","VoidConsoleVisPainterSystem")}paint(e,s){Object.values(s.visualLogs).forEach(i=>{A(this,Bi,xn).call(this,e,i)})}};Bi=new WeakSet,xn=function(t,e){let s=Te({blend:"copy"});e.all(i=>!0).forEach(i=>{let r=i.bounds();t.line({from:r[0],to:r[1],color:D.MAGENTA,thickness:3,z:1/0,material:s}),t.line({from:r[1],to:r[2],color:D.MAGENTA,thickness:3,z:1/0,material:s}),t.line({from:r[2],to:r[3],color:D.MAGENTA,thickness:3,z:1/0,material:s}),t.line({from:r[3],to:r[0],color:D.MAGENTA,thickness:3,z:1/0,material:s})})};var Ns,Vi,_n,qi=class{constructor(){I(this,Vi),I(this,Ns,new Map),this.registerSerializableClass(Q),this.registerSerializableClass(Os),this.registerSerializableClass(Ts),this.registerSerializableClass(mt)}registerSerializableClass(e){_(this,Ns).set(e.serializedName,e.fromJSON)}serialize(e){return JSON.stringify(e)}deserialize(e){return JSON.parse(e,(s,i)=>{if(!A(this,Vi,_n).call(this,i))return i;let r=_(this,Ns).get(i.__serializedName);if(!r)throw new Gi(`No deserializer set for object labeled "${i.__serializedName}"`);return r(i)})}};Ns=new WeakMap,Vi=new WeakSet,_n=function(t){return t!=null&&Object.hasOwnProperty.call(t,"__serializedName")};var Gi=class extends Error{constructor(e){super(e),this.name="DeserializeError"}},qt,Mt,ht,Rs,Yi,Ls,Ki,zs,Xi,js,Ji,Us,Zs,dt,an=class{constructor(e,s,i){I(this,Rs),I(this,Ls),I(this,zs),I(this,js),I(this,qt,new qi),f(this,"systems"),f(this,"context"),f(this,"logs",[]),f(this,"hz"),f(this,"maxUpdates"),I(this,Mt,0),f(this,"onStarted",new W),f(this,"beforeFrame",new W),f(this,"beforeSystem",new W),f(this,"afterSystem",new W),f(this,"afterFrame",new W),f(this,"isPaused"),f(this,"preload"),f(this,"inputOverride"),f(this,"snapshotBuffer",new Uint8Array(0)),I(this,ht,void 0),I(this,Us,0),I(this,Zs,-1),I(this,dt,0),this.systems=Array.isArray(s)?s:[s];for(let[r,n]of this.systems.entries())if(!n.start&&!n.update&&!n.paint&&!n.destroy)throw new Error(`System ${r} must have one of: start, update, paint, or destroy methods`);i!=null&&i.skipDefaultSystems||(this.systems.unshift(new Si(i?.behaviors||[])),this.systems.unshift(new Di),this.systems.unshift(new Wi),this.systems.unshift(new xs)),this.preload=i?.preload,this.hz=i?.hz??"unbounded",this.maxUpdates=i?.maxUpdates??3,ue(this,ht,i?.inputSource??new Ti),this.context={frame:0,time:{now:performance.now(),dt:0,hz:this.hz},inputs:new Oi,state:e,camera:{x:0,y:0,zoom:1,rotation:0,pivot:h(.5)},painter:i?.painter||new $i,screen:i?.screen||new Os({width:0}),scene:new Q({id:"__root"}),screenSpecs:{aspectRatio:1,pixelRatio:1},config:i?.config||{},multiplayer:xe.multiplayer,visualLogs:{}},this.context.painter.camera=this.context.camera,bn.context=this.context}get hasStarted(){return _(this,Mt)===2}get inputSource(){return _(this,ht)}set inputSource(e){ue(this,ht,e)}run(){this.isPaused||this.step(),ue(this,Zs,requestAnimationFrame(()=>this.run()))}step({headless:e}={headless:!1}){let s=1e3/(this.hz==="unbounded"?60:this.hz),i=performance.now()-_(this,Us)-this.context.time.now;if(this.context.time.dt=i,this.context.time.now+=i,ue(this,dt,_(this,dt)+i),_(this,ht).pollGamepads(),this.context.frame===0||this.hz==="unbounded")A(this,Ls,Ki).call(this),A(this,zs,Xi).call(this);else{let r=Math.min(Math.floor(_(this,dt)/s),this.maxUpdates);for(this.context.inputs.isCatchupFrame=!1;r>0;)this.context.inputs.isCatchupFrame||A(this,Ls,Ki).call(this),A(this,zs,Xi).call(this),r--,ue(this,dt,_(this,dt)-s),this.context.inputs.isCatchupFrame=!0}A(this,js,Ji).call(this,()=>this.paint(e))}togglePause(){this.isPaused?this.unpause():this.pause()}pause(){this.isPaused=!0}unpause(){this.isPaused=!1,ue(this,Us,performance.now()-this.context.time.now)}unmount(){this.destroy(this.context)}update(e){if(_(this,Mt)===0){ue(this,Mt,1);for(let s of this.systems){if(!s.start)continue;let i=s.start(e.state,e);i instanceof Promise?(s.isWaiting=s.isLoading=!0,i.then(()=>{s.isWaiting=s.isLoading=!1,A(this,Rs,Yi).call(this)})):s.isWaiting=s.isLoading=!1}A(this,Rs,Yi).call(this)}for(let s of this.systems)if(!s.isWaiting){if(this.beforeSystem.emit(e,s),s.update){let i=s.update(e.state,e);i instanceof Promise&&(s.isWaiting=!0,i.then(()=>{s.isWaiting=!1}))}this.afterSystem.emit(e,s)}}paint(e=!1){if(!e){this.context.painter.startFrame();for(let s of this.systems)s.isLoading||!s.paint||s.paint(this.context.painter,this.context);this.context.painter.endFrame()}}destroy(e){for(let s of this.systems)s.destroy&&s.destroy(e.state,e);this.onStarted.disconnect(),this.beforeFrame.disconnect(),this.beforeSystem.disconnect(),this.afterSystem.disconnect(),this.afterFrame.disconnect(),this.pause(),cancelAnimationFrame(_(this,Zs))}receiveInputSnapshot(e){this.context.inputs.snapshots[1]=vi(this.context.inputs.snapshots[0]),this.context.inputs.snapshots[0]=vi(e)}registerSerializableClass(e){_(this,qt).registerSerializableClass(e)}serializeState(){return JSON.stringify({random:Ts.serialize(),state:_(this,qt).serialize(this.context.state)})}deserializeState(e){let{random:s,state:i}=JSON.parse(e);return this.context.state=_(this,qt).deserialize(i),Ts.deserialize(s),this.context.state}};qt=new WeakMap,Mt=new WeakMap,ht=new WeakMap,Rs=new WeakSet,Yi=function(){this.systems.every(t=>!t.start||t.isLoading===!1)&&(ue(this,Mt,2),this.onStarted.emit(this))},Ls=new WeakSet,Ki=function(){let t=_(this,ht).readInput(),e=Ee.decodeSnapshot(t),s=()=>{this.receiveInputSnapshot(e)};this.inputOverride?this.inputOverride(t,s):s(),this.snapshotBuffer=t},zs=new WeakSet,Xi=function(){this.beforeFrame.emit(this.context),A(this,js,Ji).call(this,()=>this.update(this.context)),this.afterFrame.emit(this.context),this.context.frame++},js=new WeakSet,Ji=function(t){try{t()}catch(e){console.error(e),Zt(e instanceof Error,"error is not an instance of Error"),this.logs.push({type:"runtimeError",time:performance.now(),frame:this.context.frame,message:e.message,stack:e.stack??null})}},Us=new WeakMap,Zs=new WeakMap,dt=new WeakMap;async function Jl(t){return new Promise(e=>{setTimeout(e,t)})}var on=class{constructor(e=()=>{},s="ws://localhost:4200",i=!1){f(this,"url"),f(this,"ws"),f(this,"isVerbose",!1),f(this,"onMessage"),f(this,"sessionId",""),f(this,"onSystemMessage",()=>{}),f(this,"startTime",0),this.url=s,this.onMessage=e,this.isVerbose=i,this.ws=this.connect()}connect(){if(this.ws){if(this.ws.readyState==WebSocket.OPEN)return this.ws;this.ws.close()}return this.startTime=performance.now(),this.ws=new WebSocket(this.url),this.ws.onopen=e=>{this.isVerbose&&console.log(`WebSocket to ${this.url} opened. readyState=${this.ws.readyState}`)},this.ws.onmessage=e=>{try{let s=JSON.parse(e.data);this.isVerbose&&console.log("got ws message",s),s.type=="void:msg"?this.onMessage(s.payload):this.onSystemMessage(s),"sessionId"in s&&(this.sessionId=s.sessionId)}catch{console.error(`Couldn't JSON.parse message: ${e.data}`)}},this.ws.onclose=e=>{if(e.wasClean)this.isVerbose&&console.log(`WebSocket to ${this.url} closed cleanly. reason=${e.reason}`);else{let s=Math.floor((performance.now()-this.startTime)/1e3);console.warn(`WebSocket to ${this.url} closed in ${s}s. code=${e.code} reason=${e.reason}`),console.warn(e)}},this.ws.onerror=e=>{let s=e;if(!s)return console.error(e);console.error(s.error)},this.ws}async send(e){let s=performance.now()+5e3;for(this.ws.readyState!=WebSocket.OPEN&&(this.isVerbose&&console.warn("closing websocket in readyState",this.ws.readyState),this.close(),this.ws=this.connect());this.ws.readyState!=WebSocket.OPEN;)if(performance.now()>s)throw new Error(`Could not connect to websocket at ${this.url} in 5000`);this.ws.send(JSON.stringify({type:"void:msg",payload:e}))}close(){this.ws.close()}},Hl="nope",ln=class{constructor(e,s="unknown",i=0,r=0,n=60){f(this,"buffer"),f(this,"encoder"),f(this,"writer"),this.encoder=new TextEncoder;let a=this.encoder.encode(s),o=JSON.stringify(e),c=this.encoder.encode(o);this.buffer=new Uint8Array(4+a.length+4+c.length+(Ee.byteLength()+9)*n),this.writer=new Ke(this.buffer),this.writer.writeString(s),this.writer.writeString(o),this.writer.writeDouble(r),this.writer.writeDouble(i),console.assert(c.length<65535,`Can't record tape bc state length ${c.length} > 65535`)}get offset(){return this.writer.offset}writeInputs(e,s){this.writer.writeDouble(e),this.buffer.set(s,this.offset),this.writer.offset+=s.length}},cn=class{constructor(e){f(this,"buffer"),f(this,"version"),f(this,"state"),f(this,"startTime"),f(this,"startFrame"),f(this,"reader"),f(this,"inputLength"),e||hr("NoBuffer",`Constructed TapeReader without buffer: ${e}`),this.reader=new $e(e),this.buffer=e,this.version=this.reader.readString();let s=this.reader.readString();this.state=JSON.parse(s),this.inputLength=Ee.byteLength(20,2),this.startTime=this.reader.readDouble(),this.startFrame=this.reader.readDouble()}get offset(){return this.reader.offset}readInputs(){if(this.reader.offset>=this.buffer.length)return[0,null,!0];let e=this.reader.readDouble();if(e===0)return[0,null,!0];let s=Nt(this.buffer,this.reader.offset,this.inputLength);return this.reader.offset+=this.inputLength,[e,s,!1]}loop(){this.reader.offset=0,this.reader.bitOffset=0,this.version=this.reader.readString();let e=this.reader.readString();this.state=JSON.parse(e),this.inputLength=Ee.byteLength(20,2),this.startTime=this.reader.readDouble(),this.startFrame=this.reader.readDouble()}};function nl(t,e){let s=me(t,e);for(let i of Object.keys(s))t[i]=s[i]}function Ql(t,e,s,i){var r;for(let n of s)(r=n.start)==null||r.call(n,t,i);nl(t,e)}function J(t,e,s,i){return{node:t,field:e,blend:s,keyframes:i.map(r=>({...r,easing:r.easing??_i.linear,kind:r.kind??"interpolated"}))}}function al(t,e,s){return{status:{kind:"idle"},duration:t,loop:e,tracks:s}}function ol(t,e,s,i){return{time:t,value:e,easing:i,kind:s}}function ec(t){var e,s,i,r,n,a,o,c,l,d;let u=t.resolution.width/t.columns,m=t.resolution.height/t.rows,b=1e3/t.fps,S={width:((e=t.size)==null?void 0:e.width)??u,height:((s=t.size)==null?void 0:s.height)??m},U={x:((i=t.offset)==null?void 0:i.x)??0,y:((r=t.offset)==null?void 0:r.y)??0},F={x:((n=t.separation)==null?void 0:n.x)??0,y:((a=t.separation)==null?void 0:a.y)??0},ne={start:((o=t.select)==null?void 0:o.start)??0,end:(c=t.select)==null?void 0:c.end},R=[];for(let ee=0;ee<t.rows;ee++)for(let de=0;de<t.columns;de++){let Ds=(ee*t.columns+de-ne.start)*b,kn=F.x*de,Sn=F.y*ee;R.push(ol(Ds,{x:de*S.width+U.x+kn,y:ee*S.height+U.y+Sn},"constant"))}return R.slice((l=t.select)==null?void 0:l.start,(d=t.select)==null?void 0:d.end)}function ll(t,e,s){return s<t?0:s>e?1:(s-t)/(e-t)}var ce,Fs,cl=class Hi{constructor(e){I(this,ce,void 0),I(this,Fs,void 0),f(this,"hz",60),ue(this,ce,e.timeline),ue(this,Fs,Object.values(e.timeline)),e.hz&&(this.hz=e.hz)}play(e,s){let i=_(this,ce)[e].status;switch(i.kind){case"playing":console.warn(`Animation "${e}" is already playing - cannot play while already playing.`);break;case"paused":_(this,ce)[e].status={kind:"playing",elapsedMs:s??i.pausedAtMs,elapsedFrames:s!=null?St(s/1e3):i.pausedAtFrame};break;case"complete":case"idle":_(this,ce)[e].status={kind:"playing",elapsedMs:s??0,elapsedFrames:s!=null?St(s/1e3):0};break}}pause(e){let s=_(this,ce)[e].status;switch(s.kind){case"playing":_(this,ce)[e].status={kind:"paused",pausedAtMs:s.elapsedMs,pausedAtFrame:s.elapsedFrames};break;case"paused":console.warn(`Animation "${e}" cannot be paused because it was already "paused" at millisecond: ${s.pausedAtMs}.`);break;case"idle":console.warn(`Animation "${e}" cannot be paused because it is already "idle".`);break;case"complete":console.warn(`Animation "${e}" cannot be paused because it is already "complete".`);break}}isPlaying(e){return _(this,ce)[e].status.kind==="playing"}isPaused(e){return _(this,ce)[e].status.kind==="paused"}isIdle(e){return _(this,ce)[e].status.kind==="idle"}isComplete(e){return _(this,ce)[e].status.kind==="complete"}static callOrSetField(e,s,i){typeof e[s]=="function"?e[s](...i):e[s]=i}update(e){for(let s of _(this,Fs))if(s.status.kind==="playing"){if(s.status.elapsedMs>=s.duration)if(s.loop)s.status.elapsedMs=0,s.status.elapsedFrames=0;else{s.status={kind:"complete"};continue}for(let i of s.tracks)for(let r=0;r<=i.keyframes.length;r++){let n=i.keyframes[r],a=i.keyframes[r+1];if(n&&!a)St(n.time/1e3,this.hz)===s.status.elapsedFrames&&Hi.callOrSetField(i.node,i.field,n.value);else if(n&&a){let o=St(n.time/1e3,this.hz),c=St(a.time/1e3,this.hz);if(n.kind==="constant"&&o===s.status.elapsedFrames&&Hi.callOrSetField(i.node,i.field,n.value),a.kind==="interpolated"&&s.status.elapsedFrames>=o&&s.status.elapsedFrames<=c)if(typeof i.blend=="function"){let l=ll(n.time,a.time,s.status.elapsedMs);i.node[i.field]=i.blend(n.value,a.value,n.easing(l))}else typeof i.node[i.field]=="function"&&i.node[i.field](a.value)}}s.status.elapsedMs+=e,s.status.elapsedFrames++}}};ce=new WeakMap,Fs=new WeakMap;var ul=cl;function dl(t,e){let s={},i=t[e.spritesheet];for(let r of e.drawings){s[r.node]=[];for(let n of r.drws)s[r.node].push({frame:n.frame,repeat:n.repeat,spriteSheet:e.spritesheet,sprite:i.sprites[n.name]})}return s}function hl(t,e){let s,i={};for(let r of t.nodes){let n=new Q({id:r.name,isVisible:r.kind==="read"?r.visible:!0,color:[1,1,1,1],tags:[r.kind]}),a=new Q({id:`pivot-${r.name}`,color:[1,1,1,1]}),o=new Q({id:`offset-${r.name}`,color:[1,1,1,1]});if(a.add(o),r.kind==="read"){let c=new Q({id:`drawing-${r.name}`,color:[1,1,1,1]});o.add(c)}n.add(a),i[r.id]=n,e&&(n.add(new Q({height:10,width:10})),a.add(new Q({height:8,width:8,color:D.RED})),o.add(new Q({height:6,width:6,z:200,color:D.YELLOW})),r.kind==="read"&&o.kids[0].add(new Q({height:4,width:4,color:D.CYAN})))}for(let r of t.links)r.in==="Top"?s=i[r.out]:i[r.in].kids[0].kids[0].add(i[r.out]);return[i,s]}function Ve(t,e){return Ne(t.x-1,e-1)*1e3}function Tt(t){console.warn(`attrLink timedvalue '${t.timedvalue}' has no corresponding BEZIER. attr: '${t.attr}'. node/gobId: '${t.node}'`)}function pl(t,e,s,i,r){let n=s.reduce((o,c)=>(o[c.id]=c,o),{}),a=[];for(let o of t.attrlinks){let c=n[o.node];switch(o.attr){case"pivot":{let l=t.pivots[o.timedvalue];if(Array.isArray(l)){let d=[],u=[];for(let m of l)d.push({time:Ve({x:m.start},i),value:{x:m.x,y:-m.y},kind:"constant"}),u.push({time:Ve({x:m.start},i),value:{x:-m.x,y:+m.y},kind:"constant"});a.push(J(c.kids[0],"pos",null,d)),a.push(J(c.kids[0].kids[0],"pos",null,u))}else console.warn(`attrLink timedvalue '${o.timedvalue}' has no corresponding PIVOT. attr: '${o.attr}'. node/gobId: '${o.node}'`);break}case"position.x":case"offset.x":{let l=t.beziers[o.timedvalue];if(Array.isArray(l)){let d=[];for(let u of l)d.push({time:Ve(u,i),value:u.y});a.push(J(c,"x",z,d))}else Tt(o);break}case"position.y":case"offset.y":{let l=t.beziers[o.timedvalue];if(Array.isArray(l)){let d=[];for(let u of l)d.push({time:Ve(u,i),value:-u.y});a.push(J(c,"y",z,d))}else Tt(o);break}case"offset.z":case"position.z":{let l=t.beziers[o.timedvalue];if(Array.isArray(l)){let d=[];for(let u of l)d.push({time:Ve(u,i),value:u.y});a.push(J(c,"z",z,d))}else Tt(o);break}case"rotation.anglez":{let l=t.beziers[o.timedvalue];if(Array.isArray(l)){let d=[];for(let u of l)d.push({time:Ve(u,i),value:-u.y});a.push(J(c.kids[0],"rotation",z,d))}else Tt(o);break}case"scale.x":case"scale.y":{let l=t.beziers[o.timedvalue];if(Array.isArray(l)){let d=[];for(let u of l)d.push({time:Ve(u,i),value:u.y});a.push(J(c.kids[0].scale,o.attr==="scale.x"?"x":"y",z,d))}else Tt(o);break}case"skew":{let l=t.beziers[o.timedvalue];if(Array.isArray(l)){let d=[];for(let u of l)d.push({time:Ve(u,i),value:{x:gr(u.y),y:0}});a.push(J(c.kids[0],"skew",mr,d))}else Tt(o);break}}}for(let[o,c]of Object.entries(e)){let l=n[o];if(!l)continue;let d=l.kids[0].kids[0].kids[0],u=[],m=[],b=[],S=[],U=[],F=[],ne=[];for(let R of c)m.push({kind:"constant",time:Ne(R.frame-1,i-1)*1e3,value:{pos:{x:R.sprite.x,y:R.sprite.y},height:R.sprite.height,width:R.sprite.width}}),S.push({kind:"constant",time:Ne(R.frame-1,i-1)*1e3,value:R.sprite.height}),U.push({kind:"constant",time:Ne(R.frame-1,i-1)*1e3,value:R.sprite.width}),b.push({kind:"constant",time:Ne(R.frame-1,i-1)*1e3,value:R.sprite.scale}),u.push({kind:"constant",time:Ne(R.frame-1,i-1)*1e3,value:r[R.spriteSheet]}),F.push({kind:"constant",time:Ne(R.frame-1,i-1)*1e3,value:-R.sprite.angleDegrees}),ne.push({kind:"constant",time:Ne(R.frame-1,i-1)*1e3,value:{x:R.sprite.offset.x,y:-R.sprite.offset.y}});a.push(J(d,"texturePath",null,u)),a.push(J(d,"spriteFrame",null,m)),a.push(J(d,"height",null,S)),a.push(J(d,"width",null,U)),a.push(J(d,"scale",null,b)),a.push(J(d,"rotation",null,F)),a.push(J(d,"pos",null,ne))}return a}function tc(t,e,s,i,r,n){var a,o,c,l;let d={};for(let[u,m]of Object.entries(t.stages)){d[u]={};for(let b of m.plays){let S=e.drawingAnimations[b.drawingAnimation];L(S,`drawingAnimations.drawingAnimations[${b.drawingAnimation}] is unexpectedly null`);let U=s.animations[b.animation];L(U,`animations.animations[${b.animation}] is unexpectedly null`);let F=i.skeletons[b.skeleton];L(F,`skeletons.skeletons[${b.skeleton}] is unexpectedly null`);let ne=dl(r.sheets,S),[R,ee]=hl(F,n.debug),de=pl(U,ne,Object.values(R),b.framerate,n.spritesheets),Ds=new Q({kids:[ee],x:m.resolutionWidth/2,y:m.resolutionHeight/2});d[u][b.name]={gob:Ds,animation:new ul({timeline:{[b.name]:al(((o=(a=n.tracks)==null?void 0:a[b.name])==null?void 0:o.duration)??2e3,((l=(c=n.tracks)==null?void 0:c[b.name])==null?void 0:l.loop)??!0,de)}})}}}return d}var $s=class{constructor(e){f(this,"tweens"),f(this,"promise"),f(this,"elapsed",0),this.tweens=e}get duration(){return this.tweens.reduce((e,s)=>Math.max(e,s.duration),0)}get isRunning(){return this.tweens.some(e=>e.isRunning)}cancel(e){let s=e=="reset"?this.tweens.slice().reverse():this.tweens;this.promise&&(this.promise.signal.isCancelled=!0);for(let i of s)i.cancel(e)}finish(){this.elapsed=this.duration;for(let e of this.tweens)e.finish()}reset(){this.elapsed=0;for(let e of this.tweens)e.reset()}set(e){for(let s of this.tweens)e==0?s.reset():e<s.duration?s.set(e):e>=s.duration&&s.elapsed<s.duration&&s.finish();this.elapsed=e}run(){return this.promise=fl(this,{isPaused:!1,isCancelled:!1})}step(e){this.set(this.elapsed+e)}};function fl(t,e){let s=ml(t);return Object.assign(s,{signal:e,cancel(i){t.cancel(i),e.isCancelled=!0},pause(){e.isPaused=!0},resume(){e.isPaused=!1},get isPaused(){return e.isPaused}})}async function ml(t,e){let{tweens:s}=t;await Promise.all(s.map(i=>i.run()))}var Qi=class{constructor(e){f(this,"tweens"),f(this,"elapsed",0),f(this,"promise"),this.tweens=e}get duration(){return this.tweens.reduce((e,s)=>e+s.duration,0)}get isRunning(){return this.tweens.some(e=>!!e.isRunning)}cancel(e){let s=e=="reset"?this.tweens.slice().reverse():this.tweens;this.promise&&(this.promise.signal.isCancelled=!0);for(let i of s)i.cancel(e)}finish(){this.elapsed=this.duration;for(let e of this.tweens)e.finish()}reset(){this.elapsed=0;for(let e of this.tweens)e.reset()}set(e){let s=0;for(let i of this.tweens){let r=s,n=s+i.duration;e<=r&&i.elapsed>0?i.reset():r<e&&e<n?i.set(e-s):i.elapsed<i.duration&&e>=n&&i.finish(),s+=i.duration}this.elapsed=e}step(e){this.set(this.elapsed+e)}run(){let e={isPaused:!1,isCancelled:!1};return this.promise=gl(this,e)}};function gl(t,e){let s=yl(t,e);return Object.assign(s,{signal:e,cancel(i){t.cancel(i),e.isCancelled=!0},pause(){e.isPaused=!0},resume(){e.isPaused=!1},get isPaused(){return e.isPaused}})}async function yl(t,e){for(let s of t.tweens){if(e.isCancelled)return;await s.run()}}function Gt(t,e,s,i,r){return new C({...r,duration:i,get from(){return r?.from??t[e]},to:s,blend(n,a,o){t[e]=z(n,a,o)}})}function vl(t,e,s,i){return new C({...i,duration:s,get from(){return i?.from??{...t}},to:e,blend(r,n,a){t.x=z(r.x,n.x,a),t.y=z(r.y,n.y,a)}})}function wl(t,e,s,i){return new C({...i,duration:s,get from(){return i?.from??t.x},to:e,blend(r,n,a){t.x=z(r,n,a)}})}function bl(t,e,s,i){return new C({...i,duration:s,get from(){return i?.from??t.y},to:e,blend(r,n,a){t.y=z(r,n,a)}})}function xl(t,e,s,i){return new C({...i,get from(){return i?.from??(t.scale||h(1))},to:e,duration:s,blend(r,n,a){t.scale.x=z(r.x,n.x,a),t.scale.y=z(r.y,n.y,a)}})}function _l(t,e,s,i){return new C({...i,get from(){return i?.from??(t.scale.x||1)},to:e,duration:s,blend(r,n,a){t.scale.x=z(r,n,a)}})}function kl(t,e,s,i){return new C({...i,get from(){return i?.from??(t.scale.y||1)},to:e,duration:s,blend(r,n,a){t.scale.y=z(r,n,a)}})}function Sl(t,e,s,i){return new C({...i,get from(){return i?.from??(t.rotation||0)},to:e,duration:s,blend(r,n,a){t.rotation=z(r,n,a)*Math.PI/180}})}function Ol(t,e,s,i){return new C({...i,get from(){return i?.from??(t.rotation||0)},duration:s,to:e,blend(r,n,a){t.rotation=z(r,n,a)}})}function Tl(t,e,s,i){return new C({...i,get from(){return i?.from??t},to:e,duration:s,blend(r,n,a){let o=yr(r,n,a);t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3]}})}function Cl(t){return new Qi(t)}function Ml(t){return new $s(t)}function Pl(t){return new C({from:null,to:null,duration:t,blend(){}})}function El(t,e,s,i){return Gt(t,"left",e,s,i)}function Al(t,e,s,i){return Gt(t,"right",e,s,i)}function Il(t,e,s,i){return Gt(t,"top",e,s,i)}function Nl(t,e,s,i){return Gt(t,"bottom",e,s,i)}function Rl(t,e,s,i){return new C({...i,duration:s,get from(){return h(i?.from??t.topLeft)},to:e,blend(r,n,a){t.topLeft=r.lerp(n,a)}})}function Ll(t,e,s,i){return new C({...i,duration:s,get from(){return h(i?.from??t.center)},to:e,blend(r,n,a){t.center=r.lerp(n,a)}})}function zl(t,e,s,i){return new C({...i,duration:s,get from(){return h(i?.from??t.bottomRight)},to:e,blend(r,n,a){t.bottomRight=r.lerp(n,a)}})}function Ul(t,e,s,i){return new C({...i,duration:s,get from(){return i?.from??t.width},to:e,blend(r,n,a){t.width=z(r,n,a)}})}function Zl(t,e,s,i){return new C({...i,duration:s,get from(){return i?.from??t.height},to:e,blend(r,n,a){t.height=z(r,n,a)}})}function Fl(t,e){let s=[];for(let i=0;i<e.length;i++)s.push(C.sequence([C.delay(i*t),e[i]]));return new $s(s)}var C=class{constructor(e){f(this,"from"),f(this,"to"),f(this,"easing"),f(this,"duration"),f(this,"blend"),f(this,"opts"),f(this,"elapsed",0),f(this,"promise"),this.opts=e,this.from=e.from,this.to=e.to,this.duration=e.duration,this.blend=e.blend,this.easing=e.easing||_i.easeInOut}get isRunning(){return 0<this.elapsed&&this.elapsed<this.duration}get isFinished(){return this.elapsed>=this.duration}reset(){this.elapsed=0,this.blend(this.from,this.to,0)}finish(){this.elapsed=this.duration,this.blend(this.from,this.to,1)}set(e){this.elapsed===0&&(this.from=this.opts.from),this.elapsed=B(e,0,this.duration),this.blend(this.from,this.to,this.easing(this.elapsed/this.duration))}step(e){this.set(this.elapsed+e)}cancel(e){jl(this,e),this.promise&&(this.promise.signal.isCancelled=!0)}run(){let e={isPaused:!1,isCancelled:!1};return this.promise=$l(this,e)}};f(C,"translate",vl),f(C,"translateX",wl),f(C,"translateY",bl),f(C,"scale",xl),f(C,"scaleX",_l),f(C,"scaleY",kl),f(C,"rotate",Sl),f(C,"rotateRadians",Ol),f(C,"property",Gt),f(C,"width",Ul),f(C,"height",Zl),f(C,"left",El),f(C,"right",Al),f(C,"bottom",Nl),f(C,"top",Il),f(C,"topLeft",Rl),f(C,"bottomRight",zl),f(C,"center",Ll),f(C,"color",Tl),f(C,"sequence",Cl),f(C,"parallel",Ml),f(C,"delay",Pl),f(C,"stagger",Fl);function jl(t,e){switch(e=e||"stop",e){case"finish":t.finish();break;case"reset":t.reset();break}}function $l(t,e){let s=Dl(t,e);return Object.assign(s,{signal:e,cancel(i){this.cancel(i)},pause(){this.signal.isPaused=!0},resume(){this.signal.isPaused=!1},get isPaused(){return this.signal.isPaused}})}async function Dl(t,e){let s=performance.now(),i=s+t.duration,r=performance.now();for(t.set(0);performance.now()<i;){if(e.isCancelled)return;let n=performance.now()-r;if(r=performance.now(),e.isPaused){s+=n,i+=n,await un();continue}if(t.step(n),await un(),e.isCancelled)return}t.finish()}function un(){return new Promise(t=>{globalThis.requestAnimationFrame?globalThis.requestAnimationFrame(t):globalThis.setImmediate&&globalThis.setImmediate(t)})}export{ul as Animation,wi as ButtonPosition,D as Colors,$t as DEFAULT_BLEND,xi as DEFAULT_CLEAR_COLOR,Gi as DeserializeError,_i as Easing,an as Game,Q as Gob,ut as Hand,Tr as Key,_s as Line,Ee as MarshalInput,da as Mat3,Te as Material,rl as Multiplayer,$i as NullPainter,xe as RPC,bn as RPCSignal,Ts as Random,Os as Rect,on as Socket,qi as StateSerializer,cn as TapeReader,ln as TapeWriter,C as Tween,$s as TweenParallel,Qi as TweenSequence,we as Uniform,Hl as VERSION,mt as Vector,Ut as WebGpuPainter,Fn as alpha,Zt as assert,Mn as assertNever,L as assertNotNull,Br as bindUniforms,Gn as blend,$r as blendNames,Yr as buildModelMatrix,Gr as buildMvpMatrix,Kr as buildProjectionMatrix,qr as buildViewMatrix,Vr as canvas2texture,Yo as captureScreenshot,B as clamp,An as clampMagnitude,yr as clerp,Vo as clip2screen,Bo as createPainter,ae as createPipeline,Wr as createTextureBindGroup,ns as cubicBezier,Vn as darken,nl as deepMerge,gr as deg2rad,hr as error,Ne as framesToSeconds,Wn as hex,Dn as hsl,$n as hsv,Xl as isBoxColliding,Xr as isPointInRectangle,el as isPointWithin,ol as keyframe,z as lerp,qn as lighten,Ql as loadSnapshot,Cn as logOnce,di as magnitude,ks as measureText,Ss as opts2string,ve as presetBlends,Zn as rad2deg,$ as raw,jn as rgb,Bn as rgb2hue,qo as screen2clip,St as secondsToFrames,Jl as sleep,ec as spriteFrames,fr as text2canvas,hi as textCacheKey,ma as toBinaryString,fa as toHexString,tc as toonboom2void,J as track,al as tracks,h as vec,mr as vecLerp,ci as warnOnce,Un as wave};
/*! Bundled license information:

@vaguevoid/sdk/dist/graphics-47f48627.js:
  (*!
   * Reconnecting WebSocket
   * by Pedro Ladaria <pedro.ladaria@gmail.com>
   * https://github.com/pladaria/reconnecting-websocket
   * License MIT
   *)
*/
